import{b as Me,r as l,g as V,h as Ve,c as u,o as r,d as t,e as x,k as h,v as _,l as d,F as A,m as D,t as i,s as U,x as le,j as Q,p as Ue,w as re,y as b}from"./index-Ckvy1juH.js";import{f as z,t as H}from"./numbers-BTmV-EI5.js";import{S as ie}from"./search-kBHKDoZ1.js";import{U as ze}from"./user-plus-Cw8xWrBp.js";import{P as Ie}from"./package-Bp2UO82B.js";import{c as ue}from"./createLucideIcon-BWoJgUtG.js";import{P as Te}from"./plus-DvYpULJ4.js";import{T as Ne}from"./trash-2-BMUAPq-s.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ue("MinusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ue("ShoppingCartIcon",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Qe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Be={class:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"},Ee={class:"mb-6"},We={class:"relative"},Oe={class:"space-y-3 max-h-96 overflow-y-auto mb-6"},Je=["onClick"],He={class:"flex items-center justify-between"},Re={class:"font-bold text-lg text-gray-900"},Ge={class:"text-sm text-gray-600"},Ke={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Xe={class:"lg:col-span-2 space-y-4"},Ye={class:"card"},Ze={class:"relative"},et=["placeholder"],tt={key:0,class:"absolute left-12 top-3.5"},st={class:"flex justify-center"},at={class:"inline-flex rounded-lg border-2 border-primary-600 p-1 bg-white shadow-md"},ot={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},nt=["onClick"],lt={class:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center overflow-hidden"},rt=["src","alt"],it={class:"font-bold text-gray-900 mb-1 truncate"},ut={key:0,class:"text-sm text-gray-500 mb-2"},ct={key:1,class:"text-sm text-gray-500 mb-2 line-clamp-2"},dt={class:"flex items-center justify-between"},pt={class:"text-lg font-bold text-primary-600"},vt={class:"space-y-4"},mt={class:"card sticky top-24"},yt={class:"mb-4 p-3 bg-primary-50 rounded-lg border border-primary-200"},ft={class:"flex items-center justify-between mb-2"},gt={class:"font-bold text-gray-900"},bt={class:"text-xs text-gray-600"},xt={class:"text-xl font-bold mb-4 flex items-center gap-2"},ht={class:"space-y-3 mb-4 max-h-64 overflow-y-auto"},_t={key:0,class:"text-center py-8 text-gray-500"},wt={class:"flex-1"},kt={class:"font-medium text-sm"},Ct={class:"text-xs text-gray-500"},Pt={class:"flex items-center gap-2"},qt=["onClick"],St={class:"w-8 text-center font-bold"},jt=["onClick"],$t=["onClick"],Ft={class:"border-t pt-4 space-y-2"},Lt={class:"flex justify-between text-sm"},Mt={class:"font-bold"},Vt={class:"flex justify-between text-sm"},Ut={class:"flex justify-between text-sm"},zt={class:"flex justify-between text-lg font-bold border-t pt-2"},It={class:"text-primary-600"},Tt={class:"flex justify-between text-sm bg-blue-50 p-2 rounded"},Nt=["placeholder"],At={key:0,class:"flex justify-between text-sm text-red-600 font-bold"},Dt={class:"mt-4"},Qt={class:"grid grid-cols-3 gap-2"},Bt=["onClick"],Et={class:"mt-4 space-y-2"},Wt=["disabled"],Ot={class:"bg-white rounded-xl p-6 w-full max-w-md"},Jt={class:"flex gap-3"},ss={__name:"POS",setup(Ht){const p=Me(),y=l("products"),w=l([]),I=l([]),k=l([]),T=l([]),f=l([]),c=l([]),C=l(""),P=l(""),m=l(null),B=l(""),q=l(0),S=l(0),F=l(null),E=l("cash"),L=l(!1);l(!1);const W=l(!1);let O=null;const j=l({name:"",phone:""}),ce=[{value:"cash",label:"نقدي"},{value:"card",label:"بطاقة"},{value:"transfer",label:"تحويل"}],de=V(()=>{const s=y.value==="products"?w.value:k.value;return C.value?s:s.slice(0,12)}),pe=V(()=>{if(!P.value)return f.value;const s=P.value.toLowerCase().trim();return f.value.filter(e=>{const a=e.name.toLowerCase(),o=e.phone.toString();if(a.includes(s)||o.includes(s))return!0;let n=0;for(let v=0;v<a.length&&n<s.length;v++)a[v]===s[n]&&n++;return n===s.length}).slice(0,10)}),R=V(()=>c.value.reduce((s,e)=>s+e.unit_price*e.quantity,0)),M=V(()=>R.value+S.value-q.value),G=V(()=>{const s=F.value||M.value;return Math.max(0,M.value-s)}),ve=()=>{O&&clearTimeout(O),W.value=!0,O=setTimeout(async()=>{y.value==="products"?await me():await ye(),W.value=!1},300)},me=async()=>{const s=C.value.trim();if(!s){w.value=I.value.slice(0,12);return}const e=s.toLowerCase(),a=I.value.filter(o=>{var te,se,ae,oe,ne;const n=o.name_ar.toLowerCase(),v=((te=o.barcode)==null?void 0:te.toLowerCase())||"",g=((ae=(se=o.category)==null?void 0:se.name_ar)==null?void 0:ae.toLowerCase())||"",N=((ne=(oe=o.brand)==null?void 0:oe.name_ar)==null?void 0:ne.toLowerCase())||"";if(n.includes(e)||v.includes(e)||g.includes(e)||N.includes(e))return!0;let $=0;for(let J=0;J<n.length&&$<e.length;J++)n[J]===e[$]&&$++;return $===e.length});if(w.value=a,a.length===0&&s.length>=2)try{const o=await b.getProducts({search:s});w.value=o.data.data||o.data||[]}catch(o){console.error("Search error:",o)}},ye=async()=>{const s=C.value.trim();if(!s){k.value=T.value.slice(0,12);return}const e=s.toLowerCase(),a=T.value.filter(o=>{var g;const n=o.name_ar.toLowerCase(),v=((g=o.description)==null?void 0:g.toLowerCase())||"";return n.includes(e)||v.includes(e)});k.value=a},fe=()=>{},ge=s=>{if(!s)return"";const a=JSON.parse(s)[0];return a.startsWith("data:")?a:`http://localhost/parfumes/backend/public${a}`},be=s=>{if(!s&&s!==0)return"";const e=String(s).trim();return/\bml\b/i.test(e)||e.includes("مل")?e:`${e} مل`},K=s=>{const e=f.value.find(o=>o.id===m.value),a=(e==null?void 0:e.segment)||"قطاعي";return parseFloat(a==="جملة"?s.price_جملة:a==="صفحة"?s.price_صفحة:s.price_قطاعي)},xe=s=>{if(s.quantity===0){p.error("المنتج غير متوفر في المخزون");return}const e=c.value.find(a=>a.product.id===s.id);if(e){if(e.quantity>=s.quantity){p.error("الكمية المطلوبة غير متوفرة");return}e.quantity++}else c.value.push({product:s,quantity:1,unit_price:K(s)});p.success("تم إضافة المنتج للسلة")},he=s=>{if(s.quantity>=s.product.quantity){p.error("الكمية المطلوبة غير متوفرة");return}s.quantity++},_e=s=>{s.quantity>1?s.quantity--:X(s)},X=s=>{c.value=c.value.filter(e=>e.product.id!==s.product.id)},we=()=>{c.value.length!==0&&confirm("هل أنت متأكد من مسح السلة؟")&&(c.value=[],q.value=0,S.value=0)},ke=async()=>{try{const s=await b.createCustomer(j.value);p.success("تم إضافة العميل بنجاح"),f.value.push(s.data),m.value=s.data.id,L.value=!1,j.value={name:"",phone:""}}catch{p.error("فشل إضافة العميل")}},Ce=async()=>{var e,a,o;if(c.value.length===0)return;const s={customer_id:m.value||null,items:c.value.map(n=>({product_id:n.product.id,quantity:n.quantity,unit_price:n.unit_price})),tax:S.value,discount:q.value,paid_amount:F.value||M.value,payment_method:E.value};try{const n=await b.createSale(s),v=H(n.data.invoice_number);p.success(`تم إنشاء الفاتورة ${v}`);const g=[];if(confirm("هل تريد تحميل الفاتورة PDF؟"))try{await b.downloadInvoicePdf(n.data.id),p.success("تم تحميل الفاتورة بنجاح")}catch(N){console.error("PDF Error:",N),p.error("فشل تحميل الفاتورة PDF")}(e=n.data.customer)!=null&&e.phone&&confirm("هل تريد مشاركة الفاتورة عبر واتساب؟")&&Pe(n.data),c.value=[],q.value=0,S.value=0,F.value=null,Y()}catch(n){p.error(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.error)||"فشل إنشاء الفاتورة")}},Pe=async s=>{var e,a,o;try{const n=await b.getWhatsAppMessage(s.id),{message:v,phone:g}=n.data;if(!g){p.error("لا يوجد رقم هاتف للعميل");return}const $=`https://wa.me/${g.replace(/[^0-9]/g,"")}?text=${encodeURIComponent(v)}`;window.open($,"_blank"),p.success("تم فتح واتساب بنجاح")}catch(n){console.error("WhatsApp Error:",n),console.error("Error details:",(e=n.response)==null?void 0:e.data),p.error("فشل مشاركة الفاتورة عبر واتساب: "+(((o=(a=n.response)==null?void 0:a.data)==null?void 0:o.message)||n.message))}},Y=async()=>{try{const s=await b.getProducts(),e=s.data.data||s.data||[];I.value=e,w.value=e}catch(s){console.error("Failed to load products:",s),I.value=[],w.value=[]}},qe=async()=>{try{const s=await b.getCustomers();f.value=s.data.data||s.data||[]}catch(s){console.error("Failed to load customers:",s),f.value=[]}},Se=async()=>{try{const s=await b.getPackages(),e=s.data.data||s.data||[];T.value=e,k.value=e}catch(s){console.error("Failed to load packages:",s),T.value=[],k.value=[]}},Z=s=>{y.value=s,C.value="",s==="packages"&&k.value.length===0&&Se()},je=s=>y.value==="products"?K(s):$e(s),$e=s=>{const e=f.value.find(o=>o.id===m.value),a=(e==null?void 0:e.segment)||"قطاعي";return parseFloat(a==="جملة"?s.price_جملة:a==="صفحة"?s.price_صفحة:s.price_قطاعي)},ee=(s,e)=>{m.value=s,B.value=e,P.value="",p.success(`تم اختيار: ${e}`)},Fe=()=>{c.value.length>0&&!confirm("سيتم مسح السلة الحالية. هل تريد المتابعة؟")||(c.value=[],m.value=null,B.value="",P.value="")},Le=()=>{if(!m.value)return"قطاعي";const s=f.value.find(e=>e.id===m.value);return(s==null?void 0:s.segment)||"قطاعي"};return Ve(()=>{Y(),qe()}),(s,e)=>m.value?(r(),u("div",Ke,[t("div",Xe,[t("div",Ye,[t("div",Ze,[x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>C.value=a),onInput:ve,type:"text",placeholder:y.value==="products"?"ابحث بالاسم أو الباركود أو الفئة...":"ابحث عن باقة...",class:"input pl-10 text-lg",autofocus:""},null,40,et),[[_,C.value]]),h(d(ie),{class:"absolute left-3 top-3.5 text-gray-400",size:24}),W.value?(r(),u("div",tt,[...e[16]||(e[16]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600"},null,-1)])])):Q("",!0)])]),t("div",st,[t("div",at,[t("button",{onClick:e[4]||(e[4]=a=>Z("products")),class:U(["px-6 py-2 rounded-md font-medium transition-all",y.value==="products"?"bg-primary-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"])}," المنتجات ",2),t("button",{onClick:e[5]||(e[5]=a=>Z("packages")),class:U(["px-6 py-2 rounded-md font-medium transition-all",y.value==="packages"?"bg-primary-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"])}," الباقات ",2)])]),t("div",ot,[(r(!0),u(A,null,D(de.value,a=>(r(),u("div",{key:a.id,onClick:o=>xe(a),class:"card hover:shadow-lg cursor-pointer transition-all hover:scale-105"},[t("div",lt,[a.photos&&JSON.parse(a.photos)[0]?(r(),u("img",{key:0,src:ge(a.photos),alt:a.name_ar,class:"w-full h-full object-cover"},null,8,rt)):(r(),Ue(d(Ie),{key:1,size:48,class:"text-gray-400"}))]),t("h4",it,i(a.name_ar),1),y.value==="products"?(r(),u("p",ut,i(be(a.volume_ml)),1)):(r(),u("p",ct,i(a.description||"باقة"),1)),t("div",dt,[t("span",pt,i(d(z)(je(a))),1),t("span",{class:U(["text-xs badge",a.quantity>0?"badge-success":"badge-danger"])},i(d(H)(a.quantity))+" قطعة ",3)])],8,nt))),128))])]),t("div",vt,[t("div",mt,[t("div",yt,[t("div",ft,[t("div",null,[e[17]||(e[17]=t("p",{class:"text-sm text-gray-600"},"العميل الحالي",-1)),t("p",gt,i(B.value),1)]),t("button",{onClick:Fe,class:"text-sm text-primary-600 hover:text-primary-800 font-medium"}," تغيير ")]),t("div",bt," السعر: "+i(Le()),1)]),t("h3",xt,[h(d(De),{size:24}),e[18]||(e[18]=le(" سلة المشتريات ",-1))]),t("div",ht,[c.value.length===0?(r(),u("div",_t," السلة فارغة ")):Q("",!0),(r(!0),u(A,null,D(c.value,a=>(r(),u("div",{key:a.product.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[t("div",wt,[t("p",kt,i(a.product.name_ar),1),t("p",Ct,i(d(z)(a.unit_price)),1)]),t("div",Pt,[t("button",{onClick:o=>_e(a),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[h(d(Ae),{size:16,class:"mx-auto"})],8,qt),t("span",St,i(d(H)(a.quantity)),1),t("button",{onClick:o=>he(a),class:"w-7 h-7 rounded bg-gray-200 hover:bg-gray-300"},[h(d(Te),{size:16,class:"mx-auto"})],8,jt)]),t("button",{onClick:o=>X(a),class:"text-red-600 hover:text-red-800"},[h(d(Ne),{size:18})],8,$t)]))),128))]),t("div",Ft,[t("div",Lt,[e[19]||(e[19]=t("span",null,"المجموع الفرعي:",-1)),t("span",Mt,i(d(z)(R.value)),1)]),t("div",Vt,[e[20]||(e[20]=t("span",null,"الخصم:",-1)),x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>q.value=a),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[_,q.value,void 0,{number:!0}]])]),t("div",Ut,[e[21]||(e[21]=t("span",null,"الضريبة:",-1)),x(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>S.value=a),type:"number",step:"0.01",class:"input w-32 text-left py-1"},null,512),[[_,S.value,void 0,{number:!0}]])]),t("div",zt,[e[22]||(e[22]=t("span",null,"الإجمالي:",-1)),t("span",It,i(d(z)(M.value)),1)]),t("div",Tt,[e[23]||(e[23]=t("span",null,"المبلغ المدفوع:",-1)),x(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>F.value=a),type:"number",step:"0.01",placeholder:M.value.toString(),class:"input w-32 text-left py-1"},null,8,Nt),[[_,F.value,void 0,{number:!0}]])]),G.value>0?(r(),u("div",At,[e[24]||(e[24]=t("span",null,"المتبقي:",-1)),t("span",null,i(d(z)(G.value)),1)])):Q("",!0)]),t("div",Dt,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium mb-2"},"طريقة الدفع",-1)),t("div",Qt,[(r(),u(A,null,D(ce,a=>t("button",{key:a.value,onClick:o=>E.value=a.value,class:U([E.value===a.value?"bg-primary-600 text-white":"bg-gray-100","py-2 rounded-lg font-medium transition-all"])},i(a.label),11,Bt)),64))])]),t("div",Et,[t("button",{onClick:Ce,disabled:c.value.length===0,class:"btn btn-success w-full py-3 text-lg"}," إتمام البيع ",8,Wt),t("button",{onClick:we,class:"btn btn-secondary w-full"}," مسح السلة ")])])]),L.value?(r(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[12]||(e[12]=re(a=>L.value=!1,["self"]))},[t("div",Ot,[e[29]||(e[29]=t("h3",{class:"text-2xl font-bold mb-4"},"إضافة عميل",-1)),t("form",{onSubmit:re(ke,["prevent"]),class:"space-y-4"},[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم *",-1)),x(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>j.value.name=a),type:"text",required:"",class:"input"},null,512),[[_,j.value.name]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"رقم الهاتف *",-1)),x(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>j.value.phone=a),type:"tel",required:"",class:"input"},null,512),[[_,j.value.phone]])]),t("div",Jt,[t("button",{type:"button",onClick:e[11]||(e[11]=a=>L.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e[28]||(e[28]=t("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):Q("",!0)])):(r(),u("div",Qe,[t("div",Be,[e[15]||(e[15]=t("div",{class:"text-center mb-8"},[t("h2",{class:"text-3xl font-bold text-gray-900 mb-2"},"مرحباً بك في نقطة البيع"),t("p",{class:"text-gray-600"},"اختر العميل للمتابعة")],-1)),t("div",Ee,[t("div",We,[x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>P.value=a),onInput:fe,type:"text",placeholder:"ابحث عن عميل بالاسم أو الهاتف...",class:"input pl-10 text-lg",autofocus:""},null,544),[[_,P.value]]),h(d(ie),{class:"absolute left-3 top-3.5 text-gray-400",size:24})])]),t("div",Oe,[t("button",{onClick:e[1]||(e[1]=a=>ee(null,"عميل عادي")),class:"w-full p-4 bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 rounded-xl text-right transition-all border-2 border-transparent hover:border-primary-500"},[...e[13]||(e[13]=[t("div",{class:"flex items-center justify-between"},[t("div",null,[t("p",{class:"font-bold text-lg text-gray-900"},"عميل عادي"),t("p",{class:"text-sm text-gray-600"},"سعر قطاعي")]),t("div",{class:"bg-primary-100 text-primary-700 px-3 py-1 rounded-full text-sm font-medium"}," قطاعي ")],-1)])]),(r(!0),u(A,null,D(pe.value,a=>(r(),u("button",{key:a.id,onClick:o=>ee(a.id,a.name),class:"w-full p-4 bg-white hover:bg-gray-50 rounded-xl text-right transition-all border-2 border-gray-200 hover:border-primary-500"},[t("div",He,[t("div",null,[t("p",Re,i(a.name),1),t("p",Ge,i(a.phone),1)]),t("div",{class:U(["px-3 py-1 rounded-full text-sm font-medium",{"bg-blue-100 text-blue-700":a.segment==="جملة","bg-green-100 text-green-700":a.segment==="قطاعي","bg-purple-100 text-purple-700":a.segment==="صفحة"}])},i(a.segment),3)])],8,Je))),128))]),t("button",{onClick:e[2]||(e[2]=a=>L.value=!0),class:"w-full btn btn-primary flex items-center justify-center gap-2"},[h(d(ze),{size:20}),e[14]||(e[14]=le(" إضافة عميل جديد ",-1))])])]))}};export{ss as default};
