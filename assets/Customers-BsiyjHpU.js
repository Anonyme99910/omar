import{b as N,u as T,r as d,i as q,f as P,c as v,o as f,d as e,k as j,e as b,v as C,l as g,y as B,m as c,F as D,n as F,t as l,x as I,w as L,A,z as y}from"./index-D07TEuVv.js";import{t as w,f as Q}from"./numbers-BTmV-EI5.js";import{P as R}from"./plus-BFjEYChG.js";import{E as G}from"./eye-DEPMPUOv.js";import{P as H}from"./pen-square-D3_LOC9M.js";import{T as J}from"./trash-2-BawM9Hit.js";import"./createLucideIcon-BpdS0zN4.js";const K={class:"space-y-6"},O={class:"flex justify-between items-center"},W={class:"card overflow-hidden"},X={class:"table"},Y={class:"font-medium"},Z={class:"font-mono"},ee={class:"font-bold text-green-600"},te={class:"flex items-center gap-2"},se=["onClick"],oe=["onClick"],ne=["onClick"],le={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ae={class:"bg-white rounded-xl p-6 w-full max-w-md"},re={class:"text-2xl font-bold mb-6"},ue={class:"flex gap-3 justify-end mt-6"},ie={type:"submit",class:"btn btn-primary"},ye={__name:"Customers",setup(de){const a=N(),k=T(),r=d([]),m=d(""),h=d(!1),u=d(!1),p=d(null),n=d({name:"",phone:"",address:"",segment:"قطاعي"}),V=q(()=>m.value?r.value.filter(o=>o.name.includes(m.value)||o.phone.includes(m.value)):r.value),z=o=>Q(o),M=o=>{k.push(`/clients/${o}`)},x=async()=>{try{const o=await y.getCustomers({per_page:100});r.value=o.data.data||o.data}catch(o){a.error("فشل تحميل العملاء"),console.error(o)}},$=async()=>{var o;try{const t={name:n.value.name,phone:n.value.phone,address:n.value.address,segment:n.value.segment};if(console.log("Submitting customer form:",t),u.value){console.log("Updating customer ID:",p.value);const s=await y.updateCustomer(p.value,t);console.log("Update response:",s.data);const i=r.value.findIndex(E=>E.id===p.value);i!==-1&&(r.value[i]={...r.value[i],...s.data}),a.success("تم تحديث العميل بنجاح")}else{const s=await y.createCustomer(t);console.log("Create response:",s.data),a.success("تم إضافة العميل بنجاح")}_(),await x()}catch(t){console.error("Submit error:",t),console.error("Error response:",(o=t.response)==null?void 0:o.data),a.error("حدث خطأ")}},S=o=>{n.value={...o},p.value=o.id,u.value=!0},U=async o=>{if(confirm("هل أنت متأكد من حذف هذا العميل؟"))try{await y.deleteCustomer(o),a.success("تم حذف العميل بنجاح"),x()}catch{a.error("فشل حذف العميل")}},_=()=>{h.value=!1,u.value=!1,p.value=null,n.value={name:"",phone:"",address:"",segment:"قطاعي"}};return P(()=>{x()}),(o,t)=>(f(),v("div",K,[e("div",O,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),type:"text",placeholder:"البحث عن عميل...",class:"input w-80"},null,512),[[C,m.value]]),e("button",{onClick:t[1]||(t[1]=s=>h.value=!0),class:"btn btn-primary flex items-center gap-2"},[g(c(R),{size:20}),t[5]||(t[5]=B(" إضافة عميل ",-1))])]),e("div",W,[e("table",X,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"الاسم"),e("th",null,"الهاتف"),e("th",null,"الشريحة"),e("th",null,"إجمالي المشتريات"),e("th",null,"عدد الطلبات"),e("th",null,"الإجراءات")])],-1)),e("tbody",null,[(f(!0),v(D,null,F(V.value,s=>(f(),v("tr",{key:`customer-${s.id}-${s.segment}`},[e("td",Y,l(s.name),1),e("td",Z,l(c(w)(s.phone)),1),e("td",null,[e("span",{class:I(["badge",s.segment==="جملة"?"badge-success":s.segment==="قطاعي"?"badge-primary":"badge-warning"])},l(s.segment||"قطاعي"),3)]),e("td",ee,l(z(s.total_purchases)),1),e("td",null,l(c(w)(s.total_orders)),1),e("td",null,[e("div",te,[e("button",{onClick:i=>M(s.id),class:"text-gray-700 hover:text-gray-900"},[g(c(G),{size:18})],8,se),e("button",{onClick:i=>S(s),class:"text-blue-600 hover:text-blue-800"},[g(c(H),{size:18})],8,oe),e("button",{onClick:i=>U(s.id),class:"text-red-600 hover:text-red-800"},[g(c(J),{size:18})],8,ne)])])]))),128))])])]),h.value||u.value?(f(),v("div",le,[e("div",ae,[e("h3",re,l(u.value?"تعديل عميل":"إضافة عميل جديد"),1),e("form",{onSubmit:L($,["prevent"]),class:"space-y-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.name=s),type:"text",required:"",class:"input"},null,512),[[C,n.value.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium mb-2"},"الهاتف",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.phone=s),type:"tel",required:"",class:"input"},null,512),[[C,n.value.phone]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium mb-2"},"الشريحة",-1)),b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.segment=s),class:"input",required:""},[...t[9]||(t[9]=[e("option",{value:"جملة"},"جملة",-1),e("option",{value:"قطاعي"},"قطاعي",-1),e("option",{value:"صفحة"},"صفحة",-1)])],512),[[A,n.value.segment]])]),e("div",ue,[e("button",{type:"button",onClick:_,class:"btn btn-secondary"},"إلغاء"),e("button",ie,l(u.value?"تحديث":"إضافة"),1)])],32)])])):j("",!0)]))}};export{ye as default};
