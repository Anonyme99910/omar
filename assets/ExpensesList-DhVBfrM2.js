import{b as Q,r as x,g as W,h as Z,c,o as m,d as t,j as P,k as y,x as D,l as v,t as o,e as r,v as b,z,F as $,m as L,s as ee,w as T,A as te,y as _}from"./index-Se31X44e.js";import{P as N}from"./plus-BdaN5aG-.js";import{R as se}from"./receipt-B62EMl6O.js";import{c as q}from"./createLucideIcon-BxNOhi-4.js";import{T as le}from"./trending-up-CFp31D5q.js";import{D as ne}from"./download-Js616hso.js";import{X as ae}from"./x-D4KytZwg.js";import{P as oe}from"./pen-FlCm6lBC.js";import{T as re}from"./trash-2-D3JE70ue.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=q("CalendarIcon",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=q("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ue={class:"space-y-6"},pe={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},xe={class:"flex gap-3"},ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},me={class:"card bg-gradient-to-br from-blue-500 to-blue-600 text-white"},ye={class:"flex items-center justify-between"},ve={class:"text-3xl font-bold"},fe={class:"text-blue-100 text-xs mt-1"},ge={class:"card bg-gradient-to-br from-green-500 to-green-600 text-white"},be={class:"flex items-center justify-between"},_e={class:"text-3xl font-bold"},we={class:"card bg-gradient-to-br from-purple-500 to-purple-600 text-white"},ke={class:"flex items-center justify-between"},he={class:"text-3xl font-bold"},Ee={class:"card bg-gradient-to-br from-orange-500 to-orange-600 text-white"},Se={class:"flex items-center justify-between"},Ce={class:"text-3xl font-bold"},Fe={class:"card"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ze=["value"],Te={class:"flex gap-3 mt-4"},Ue={class:"card overflow-hidden"},Ve={class:"overflow-x-auto"},Pe={class:"w-full"},$e={class:"divide-y divide-gray-200"},Le={class:"px-6 py-4 whitespace-nowrap text-sm"},Me={class:"px-6 py-4 whitespace-nowrap"},je={class:"text-sm font-medium"},Ie={class:"px-6 py-4 whitespace-nowrap"},Re={class:"text-lg font-bold text-red-600"},Ne={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm"},Ae={class:"flex gap-2"},Be=["onClick"],Ge=["onClick"],Xe={key:0},Ye={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},He={class:"text-2xl font-bold mb-4"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke=["value"],Qe={class:"flex items-center"},We={class:"flex gap-3 pt-2"},Ze={type:"submit",class:"btn btn-primary flex-1"},et={class:"bg-white rounded-xl p-6 w-full max-w-md"},tt={class:"flex gap-3 pt-2"},xt={__name:"ExpensesList",setup(st){const d=Q(),w=x([]),U=x([]),u=x({total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0}),S=x(!1),h=x(!1),k=x(!1),C=x(null),n=x({start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""}),a=x({expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1}),f=x({name_ar:"",name_en:"",description:""}),O=W(()=>{const l=new Date(n.value.start_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),e=new Date(n.value.end_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});return`${l} - ${e}`}),g=async()=>{var l;try{const e={};n.value.start_date&&(e.start_date=n.value.start_date),n.value.end_date&&(e.end_date=n.value.end_date),n.value.expense_type_id&&(e.expense_type_id=n.value.expense_type_id),n.value.recurrence_type&&(e.recurrence_type=n.value.recurrence_type),console.log("Fetching expenses with params:",e);const s=await _.getExpenses(e);console.log("API Response:",s.data),w.value=s.data.data||s.data||[],console.log("Expenses loaded:",w.value.length,w.value)}catch(e){console.error("Failed to fetch expenses:",e),console.error("Error details:",(l=e.response)==null?void 0:l.data),d.error("فشل تحميل المصروفات")}},M=async()=>{try{const l=await _.getExpenseTypes();U.value=l.data.data||[]}catch(l){console.error("Failed to fetch expense types:",l)}},F=async()=>{try{const l={};n.value.start_date&&(l.start_date=n.value.start_date),n.value.end_date&&(l.end_date=n.value.end_date);const e=await _.getExpenseStatistics(l);u.value=e.data.data||{total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0},console.log("Statistics:",u.value)}catch(l){console.error("Failed to fetch statistics:",l)}},A=()=>{k.value=!1,C.value=null,a.value={expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1},S.value=!0},B=l=>{k.value=!0,C.value=l.id,a.value={expense_type_id:l.expense_type_id,amount:l.amount,expense_date:l.expense_date,recurrence_type:l.recurrence_type,remarks:l.remarks||"",is_fixed:l.is_fixed},S.value=!0},G=async()=>{try{k.value?(await _.updateExpense(C.value,a.value),d.success("تم تحديث المصروف بنجاح")):(await _.createExpense(a.value),d.success("تم إضافة المصروف بنجاح")),V(),g(),F()}catch(l){console.error("Failed to save expense:",l),d.error("فشل حفظ المصروف")}},X=async l=>{if(confirm("هل أنت متأكد من حذف هذا المصروف؟"))try{await _.deleteExpense(l),d.success("تم حذف المصروف بنجاح"),g(),F()}catch(e){console.error("Failed to delete expense:",e),d.error("فشل حذف المصروف")}},Y=async()=>{try{await _.createExpenseType(f.value),d.success("تم إضافة نوع المصروف بنجاح"),h.value=!1,f.value={name_ar:"",name_en:"",description:""},M()}catch(l){console.error("Failed to save expense type:",l),d.error("فشل حفظ نوع المصروف")}},V=()=>{S.value=!1,k.value=!1,C.value=null},H=()=>{n.value={start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""},g(),F()},J=async()=>{try{const{jsPDF:l}=window.jspdf,e=new l;e.setFontSize(18),e.text("EXPENSES REPORT",105,20,{align:"center"}),e.setFontSize(12),e.text(`Period: ${n.value.start_date} to ${n.value.end_date}`,105,30,{align:"center"}),e.setFontSize(10),e.text(`Total Expenses: ${p(u.value.total_expenses)}`,20,45),e.text(`Monthly Expenses: ${p(u.value.monthly_expenses)}`,20,52),e.text(`Yearly Expenses: ${p(u.value.yearly_expenses)}`,20,59),e.text(`Fixed Expenses: ${p(u.value.fixed_expenses)}`,20,66);const s=w.value.map(i=>{var R;return[j(i.expense_date),((R=i.expense_type)==null?void 0:R.name_ar)||"-",p(i.amount),I(i.recurrence_type),i.remarks||"-"]});e.autoTable({startY:75,head:[["Date","Type","Amount","Recurrence","Remarks"]],body:s,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}});const E=e.internal.getNumberOfPages();for(let i=1;i<=E;i++)e.setPage(i),e.setFontSize(9),e.text(`Page ${i} of ${E}`,105,e.internal.pageSize.height-10,{align:"center"});e.save(`expenses-${new Date().toISOString().split("T")[0]}.pdf`),d.success("تم تصدير التقرير بنجاح")}catch(l){console.error("PDF export error:",l),d.error("فشل تصدير التقرير")}},p=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0).replace("EGP","ج.م"),j=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),I=l=>({once:"مرة واحدة",monthly:"شهري",yearly:"سنوي"})[l]||l,K=l=>({once:"badge badge-secondary",monthly:"badge badge-primary",yearly:"badge badge-success"})[l]||"badge";return Z(()=>{g(),M(),F()}),(l,e)=>(m(),c("div",ue,[t("div",pe,[e[18]||(e[18]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"المصروفات"),t("p",{class:"text-gray-600 mt-1"},"إدارة وتتبع جميع المصروفات")],-1)),t("div",xe,[t("button",{onClick:e[0]||(e[0]=s=>h.value=!0),class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(N),{size:20}),e[16]||(e[16]=D(" إضافة نوع مصروف ",-1))]),t("button",{onClick:A,class:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(N),{size:20}),e[17]||(e[17]=D(" إضافة مصروف ",-1))])])]),t("div",ce,[t("div",me,[t("div",ye,[t("div",null,[e[19]||(e[19]=t("p",{class:"text-blue-100 text-sm mb-1"},"إجمالي المصروفات",-1)),t("h3",ve,o(p(u.value.total_expenses)),1),t("p",fe,o(O.value),1)]),y(v(se),{size:48,class:"text-blue-200"})])]),t("div",ge,[t("div",be,[t("div",null,[e[20]||(e[20]=t("p",{class:"text-green-100 text-sm mb-1"},"المصروفات الشهرية",-1)),t("h3",_e,o(p(u.value.monthly_expenses)),1),e[21]||(e[21]=t("p",{class:"text-green-100 text-xs mt-1"},"متكررة شهرياً",-1))]),y(v(ie),{size:48,class:"text-green-200"})])]),t("div",we,[t("div",ke,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-purple-100 text-sm mb-1"},"المصروفات السنوية",-1)),t("h3",he,o(p(u.value.yearly_expenses)),1),e[23]||(e[23]=t("p",{class:"text-purple-100 text-xs mt-1"},"متكررة سنوياً",-1))]),y(v(le),{size:48,class:"text-purple-200"})])]),t("div",Ee,[t("div",Se,[t("div",null,[e[24]||(e[24]=t("p",{class:"text-orange-100 text-sm mb-1"},"المصروفات الثابتة",-1)),t("h3",Ce,o(p(u.value.fixed_expenses)),1),e[25]||(e[25]=t("p",{class:"text-orange-100 text-xs mt-1"},"مصروفات ثابتة",-1))]),y(v(de),{size:48,class:"text-orange-200"})])])]),t("div",Fe,[t("div",De,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"من تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.start_date=s),type:"date",class:"input",onChange:g},null,544),[[b,n.value.start_date]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"إلى تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.end_date=s),type:"date",class:"input",onChange:g},null,544),[[b,n.value.end_date]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف",-1)),r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.expense_type_id=s),class:"input",onChange:g},[e[28]||(e[28]=t("option",{value:""},"الكل",-1)),(m(!0),c($,null,L(U.value,s=>(m(),c("option",{key:s.id,value:s.id},o(s.name_ar),9,ze))),128))],544),[[z,n.value.expense_type_id]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار",-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.recurrence_type=s),class:"input",onChange:g},[...e[30]||(e[30]=[t("option",{value:""},"الكل",-1),t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],544),[[z,n.value.recurrence_type]])])]),t("div",Te,[t("button",{onClick:J,class:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(ne),{size:20}),e[32]||(e[32]=D(" تصدير PDF ",-1))]),t("button",{onClick:H,class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(ae),{size:20}),e[33]||(e[33]=D(" إعادة تعيين ",-1))])])]),t("div",Ue,[t("div",Ve,[t("table",Pe,[e[35]||(e[35]=t("thead",{class:"bg-gray-50 border-b"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التاريخ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"نوع المصروف"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"المبلغ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التكرار"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ملاحظات"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"إجراءات")])],-1)),t("tbody",$e,[(m(!0),c($,null,L(w.value,s=>{var E;return m(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Le,o(j(s.expense_date)),1),t("td",Me,[t("span",je,o(((E=s.expense_type)==null?void 0:E.name_ar)||"غير محدد"),1)]),t("td",Ie,[t("span",Re,o(p(s.amount)),1)]),t("td",Ne,[t("span",{class:ee(K(s.recurrence_type))},o(I(s.recurrence_type)),3)]),t("td",qe,o(s.remarks||"-"),1),t("td",Oe,[t("div",Ae,[t("button",{onClick:i=>B(s),class:"text-blue-600 hover:text-blue-800"},[y(v(oe),{size:18})],8,Be),t("button",{onClick:i=>X(s.id),class:"text-red-600 hover:text-red-800"},[y(v(re),{size:18})],8,Ge)])])])}),128)),w.value.length===0?(m(),c("tr",Xe,[...e[34]||(e[34]=[t("td",{colspan:"6",class:"px-6 py-8 text-center text-gray-500"}," لا توجد مصروفات ",-1)])])):P("",!0)])])])]),S.value?(m(),c("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:T(V,["self"])},[t("div",Ye,[t("h3",He,o(k.value?"تعديل مصروف":"إضافة مصروف جديد"),1),t("form",{onSubmit:T(G,["prevent"]),class:"space-y-4"},[t("div",Je,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف *",-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.expense_type_id=s),required:"",class:"input"},[e[36]||(e[36]=t("option",{value:""},"اختر نوع المصروف",-1)),(m(!0),c($,null,L(U.value,s=>(m(),c("option",{key:s.id,value:s.id},o(s.name_ar),9,Ke))),128))],512),[[z,a.value.expense_type_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium mb-2"},"المبلغ *",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.amount=s),type:"number",step:"0.01",required:"",class:"input",placeholder:"0.00"},null,512),[[b,a.value.amount]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-2"},"التاريخ *",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.expense_date=s),type:"date",required:"",class:"input"},null,512),[[b,a.value.expense_date]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار *",-1)),r(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.recurrence_type=s),required:"",class:"input"},[...e[40]||(e[40]=[t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],512),[[z,a.value.recurrence_type]])])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-2"},"ملاحظات",-1)),r(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.remarks=s),rows:"3",class:"input",placeholder:"أضف ملاحظات..."},null,512),[[b,a.value.remarks]])]),t("div",Qe,[r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.is_fixed=s),type:"checkbox",id:"is_fixed",class:"mr-2"},null,512),[[te,a.value.is_fixed]]),e[43]||(e[43]=t("label",{for:"is_fixed",class:"text-sm font-medium"},"مصروف ثابت",-1))]),t("div",We,[t("button",{type:"button",onClick:V,class:"btn btn-secondary flex-1"},"إلغاء"),t("button",Ze,o(k.value?"تحديث":"حفظ"),1)])],32)])])):P("",!0),h.value?(m(),c("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[15]||(e[15]=T(s=>h.value=!1,["self"]))},[t("div",et,[e[48]||(e[48]=t("h3",{class:"text-2xl font-bold mb-4"},"إضافة نوع مصروف",-1)),t("form",{onSubmit:T(Y,["prevent"]),class:"space-y-4"},[t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالعربية *",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>f.value.name_ar=s),type:"text",required:"",class:"input",placeholder:"مثال: الإيجار"},null,512),[[b,f.value.name_ar]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالإنجليزية",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>f.value.name_en=s),type:"text",class:"input",placeholder:"Example: Rent"},null,512),[[b,f.value.name_en]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium mb-2"},"الوصف",-1)),r(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>f.value.description=s),rows:"2",class:"input",placeholder:"وصف نوع المصروف..."},null,512),[[b,f.value.description]])]),t("div",tt,[t("button",{type:"button",onClick:e[14]||(e[14]=s=>h.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e[47]||(e[47]=t("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):P("",!0)]))}};export{xt as default};
