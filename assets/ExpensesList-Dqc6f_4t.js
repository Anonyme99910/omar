import{b as K,r as p,g as Q,h as W,c as x,o as m,d as e,j as M,k as c,x as C,l as y,t as o,e as r,v as b,z as T,F as $,m as I,s as Z,w as z,A as ee,y as _}from"./index-DkD6fnpo.js";import{P as R}from"./plus-BvXeu3T1.js";import{R as te}from"./receipt-B7Go0doB.js";import{c as O}from"./createLucideIcon-BhtB90mO.js";import{T as se}from"./trending-up-Ct0v8DJ4.js";import{D as le}from"./download-D-_G508N.js";import{X as ne}from"./x-C2AC06Yn.js";import{P as ae}from"./pen-af-zSvFe.js";import{T as oe}from"./trash-2-qeFSyXRQ.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=O("CalendarIcon",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),de={class:"space-y-6"},ue={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},pe={class:"flex gap-3"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},me={class:"card bg-gradient-to-br from-blue-500 to-blue-600 text-white"},ce={class:"flex items-center justify-between"},ye={class:"text-3xl font-bold"},ve={class:"text-blue-100 text-xs mt-1"},fe={class:"card bg-gradient-to-br from-green-500 to-green-600 text-white"},ge={class:"flex items-center justify-between"},be={class:"text-3xl font-bold"},_e={class:"card bg-gradient-to-br from-purple-500 to-purple-600 text-white"},we={class:"flex items-center justify-between"},ke={class:"text-3xl font-bold"},he={class:"card bg-gradient-to-br from-orange-500 to-orange-600 text-white"},De={class:"flex items-center justify-between"},Se={class:"text-3xl font-bold"},Ee={class:"card"},Fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ce=["value"],Te={class:"flex gap-3 mt-4"},ze={class:"card overflow-hidden"},Ve={class:"overflow-x-auto"},Ue={class:"w-full"},Me={class:"divide-y divide-gray-200"},$e={class:"px-6 py-4 whitespace-nowrap text-sm"},Ie={class:"px-6 py-4 whitespace-nowrap"},Le={class:"text-sm font-medium"},je={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"text-lg font-bold text-red-600"},Re={class:"px-6 py-4 whitespace-nowrap"},Oe={class:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm"},Ye={class:"flex gap-2"},qe=["onClick"],Ae=["onClick"],Be={key:0},Ge={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Xe={class:"text-2xl font-bold mb-4"},He={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je=["value"],Ke={class:"flex items-center"},Qe={class:"flex gap-3 pt-2"},We={type:"submit",class:"btn btn-primary flex-1"},Ze={class:"bg-white rounded-xl p-6 w-full max-w-md"},et={class:"flex gap-3 pt-2"},pt={__name:"ExpensesList",setup(tt){const i=K(),k=p([]),V=p([]),d=p({total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0}),D=p(!1),h=p(!1),w=p(!1),S=p(null),n=p({start_date:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],end_date:new Date(new Date().getFullYear(),new Date().getMonth()+1,0).toISOString().split("T")[0],expense_type_id:"",recurrence_type:""}),a=p({expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1}),v=p({name_ar:"",name_en:"",description:""}),N=Q(()=>{const l=new Date(n.value.start_date).toLocaleDateString("ar-EG",{month:"long",day:"numeric"}),t=new Date(n.value.end_date).toLocaleDateString("ar-EG",{month:"long",day:"numeric"});return`${l} - ${t}`}),f=async()=>{try{const l={};n.value.start_date&&(l.start_date=n.value.start_date),n.value.end_date&&(l.end_date=n.value.end_date),n.value.expense_type_id&&(l.expense_type_id=n.value.expense_type_id),n.value.recurrence_type&&(l.recurrence_type=n.value.recurrence_type);const t=await _.getExpenses(l);k.value=t.data.data||[],console.log("Expenses loaded:",k.value.length)}catch(l){console.error("Failed to fetch expenses:",l),i.error("فشل تحميل المصروفات")}},L=async()=>{try{const l=await _.getExpenseTypes();V.value=l.data.data||[]}catch(l){console.error("Failed to fetch expense types:",l)}},E=async()=>{try{const l={};n.value.start_date&&(l.start_date=n.value.start_date),n.value.end_date&&(l.end_date=n.value.end_date);const t=await _.getExpenseStatistics(l);d.value=t.data.data||{total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0},console.log("Statistics:",d.value)}catch(l){console.error("Failed to fetch statistics:",l)}},Y=()=>{w.value=!1,S.value=null,a.value={expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1},D.value=!0},q=l=>{w.value=!0,S.value=l.id,a.value={expense_type_id:l.expense_type_id,amount:l.amount,expense_date:l.expense_date,recurrence_type:l.recurrence_type,remarks:l.remarks||"",is_fixed:l.is_fixed},D.value=!0},A=async()=>{try{w.value?(await _.updateExpense(S.value,a.value),i.success("تم تحديث المصروف بنجاح")):(await _.createExpense(a.value),i.success("تم إضافة المصروف بنجاح")),U(),f(),E()}catch(l){console.error("Failed to save expense:",l),i.error("فشل حفظ المصروف")}},B=async l=>{if(confirm("هل أنت متأكد من حذف هذا المصروف؟"))try{await _.deleteExpense(l),i.success("تم حذف المصروف بنجاح"),f(),E()}catch(t){console.error("Failed to delete expense:",t),i.error("فشل حذف المصروف")}},G=async()=>{try{await _.createExpenseType(v.value),i.success("تم إضافة نوع المصروف بنجاح"),h.value=!1,v.value={name_ar:"",name_en:"",description:""},L()}catch(l){console.error("Failed to save expense type:",l),i.error("فشل حفظ نوع المصروف")}},U=()=>{D.value=!1,w.value=!1,S.value=null},X=()=>{n.value={start_date:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],end_date:new Date(new Date().getFullYear(),new Date().getMonth()+1,0).toISOString().split("T")[0],expense_type_id:"",recurrence_type:""},f(),E()},H=async()=>{try{const{jsPDF:l}=window.jspdf,t=new l;t.setFontSize(18),t.text("Expenses Report",105,20,{align:"center"}),t.setFontSize(12),t.text(`${n.value.start_date} to ${n.value.end_date}`,105,30,{align:"center"}),t.setFontSize(10),t.text(`Total Expenses: ${u(d.value.total_expenses)}`,20,45),t.text(`Monthly Expenses: ${u(d.value.monthly_expenses)}`,20,52),t.text(`Yearly Expenses: ${u(d.value.yearly_expenses)}`,20,59),t.text(`Fixed Expenses: ${u(d.value.fixed_expenses)}`,20,66);const s=k.value.map(g=>{var F;return[j(g.expense_date),((F=g.expense_type)==null?void 0:F.name_ar)||"N/A",u(g.amount),P(g.recurrence_type),g.remarks||"-"]});t.autoTable({startY:75,head:[["Date","Type","Amount","Recurrence","Remarks"]],body:s,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}}),t.save(`expenses-${new Date().toISOString().split("T")[0]}.pdf`),i.success("تم تصدير التقرير بنجاح")}catch(l){console.error("PDF export error:",l),i.error("فشل تصدير التقرير")}},u=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0).replace("EGP","ج.م"),j=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),P=l=>({once:"مرة واحدة",monthly:"شهري",yearly:"سنوي"})[l]||l,J=l=>({once:"badge badge-secondary",monthly:"badge badge-primary",yearly:"badge badge-success"})[l]||"badge";return W(()=>{f(),L(),E()}),(l,t)=>(m(),x("div",de,[e("div",ue,[t[18]||(t[18]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"المصروفات"),e("p",{class:"text-gray-600 mt-1"},"إدارة وتتبع جميع المصروفات")],-1)),e("div",pe,[e("button",{onClick:t[0]||(t[0]=s=>h.value=!0),class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(R),{size:20}),t[16]||(t[16]=C(" إضافة نوع مصروف ",-1))]),e("button",{onClick:Y,class:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(R),{size:20}),t[17]||(t[17]=C(" إضافة مصروف ",-1))])])]),e("div",xe,[e("div",me,[e("div",ce,[e("div",null,[t[19]||(t[19]=e("p",{class:"text-blue-100 text-sm mb-1"},"إجمالي المصروفات",-1)),e("h3",ye,o(u(d.value.total_expenses)),1),e("p",ve,o(N.value),1)]),c(y(te),{size:48,class:"text-blue-200"})])]),e("div",fe,[e("div",ge,[e("div",null,[t[20]||(t[20]=e("p",{class:"text-green-100 text-sm mb-1"},"المصروفات الشهرية",-1)),e("h3",be,o(u(d.value.monthly_expenses)),1),t[21]||(t[21]=e("p",{class:"text-green-100 text-xs mt-1"},"متكررة شهرياً",-1))]),c(y(re),{size:48,class:"text-green-200"})])]),e("div",_e,[e("div",we,[e("div",null,[t[22]||(t[22]=e("p",{class:"text-purple-100 text-sm mb-1"},"المصروفات السنوية",-1)),e("h3",ke,o(u(d.value.yearly_expenses)),1),t[23]||(t[23]=e("p",{class:"text-purple-100 text-xs mt-1"},"متكررة سنوياً",-1))]),c(y(se),{size:48,class:"text-purple-200"})])]),e("div",he,[e("div",De,[e("div",null,[t[24]||(t[24]=e("p",{class:"text-orange-100 text-sm mb-1"},"المصروفات الثابتة",-1)),e("h3",Se,o(u(d.value.fixed_expenses)),1),t[25]||(t[25]=e("p",{class:"text-orange-100 text-xs mt-1"},"مصروفات ثابتة",-1))]),c(y(ie),{size:48,class:"text-orange-200"})])])]),e("div",Ee,[e("div",Fe,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-2"},"من تاريخ",-1)),r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.start_date=s),type:"date",class:"input",onChange:f},null,544),[[b,n.value.start_date]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-2"},"إلى تاريخ",-1)),r(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.end_date=s),type:"date",class:"input",onChange:f},null,544),[[b,n.value.end_date]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف",-1)),r(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.expense_type_id=s),class:"input",onChange:f},[t[28]||(t[28]=e("option",{value:""},"الكل",-1)),(m(!0),x($,null,I(V.value,s=>(m(),x("option",{key:s.id,value:s.id},o(s.name_ar),9,Ce))),128))],544),[[T,n.value.expense_type_id]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium mb-2"},"التكرار",-1)),r(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.recurrence_type=s),class:"input",onChange:f},[...t[30]||(t[30]=[e("option",{value:""},"الكل",-1),e("option",{value:"once"},"مرة واحدة",-1),e("option",{value:"monthly"},"شهري",-1),e("option",{value:"yearly"},"سنوي",-1)])],544),[[T,n.value.recurrence_type]])])]),e("div",Te,[e("button",{onClick:H,class:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(le),{size:20}),t[32]||(t[32]=C(" تصدير PDF ",-1))]),e("button",{onClick:X,class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(ne),{size:20}),t[33]||(t[33]=C(" إعادة تعيين ",-1))])])]),e("div",ze,[e("div",Ve,[e("table",Ue,[t[35]||(t[35]=e("thead",{class:"bg-gray-50 border-b"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التاريخ"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"نوع المصروف"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"المبلغ"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التكرار"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ملاحظات"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"إجراءات")])],-1)),e("tbody",Me,[(m(!0),x($,null,I(k.value,s=>{var g;return m(),x("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",$e,o(j(s.expense_date)),1),e("td",Ie,[e("span",Le,o(((g=s.expense_type)==null?void 0:g.name_ar)||"غير محدد"),1)]),e("td",je,[e("span",Pe,o(u(s.amount)),1)]),e("td",Re,[e("span",{class:Z(J(s.recurrence_type))},o(P(s.recurrence_type)),3)]),e("td",Oe,o(s.remarks||"-"),1),e("td",Ne,[e("div",Ye,[e("button",{onClick:F=>q(s),class:"text-blue-600 hover:text-blue-800"},[c(y(ae),{size:18})],8,qe),e("button",{onClick:F=>B(s.id),class:"text-red-600 hover:text-red-800"},[c(y(oe),{size:18})],8,Ae)])])])}),128)),k.value.length===0?(m(),x("tr",Be,[...t[34]||(t[34]=[e("td",{colspan:"6",class:"px-6 py-8 text-center text-gray-500"}," لا توجد مصروفات ",-1)])])):M("",!0)])])])]),D.value?(m(),x("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:z(U,["self"])},[e("div",Ge,[e("h3",Xe,o(w.value?"تعديل مصروف":"إضافة مصروف جديد"),1),e("form",{onSubmit:z(A,["prevent"]),class:"space-y-4"},[e("div",He,[e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف *",-1)),r(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.expense_type_id=s),required:"",class:"input"},[t[36]||(t[36]=e("option",{value:""},"اختر نوع المصروف",-1)),(m(!0),x($,null,I(V.value,s=>(m(),x("option",{key:s.id,value:s.id},o(s.name_ar),9,Je))),128))],512),[[T,a.value.expense_type_id]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium mb-2"},"المبلغ *",-1)),r(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.amount=s),type:"number",step:"0.01",required:"",class:"input",placeholder:"0.00"},null,512),[[b,a.value.amount]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium mb-2"},"التاريخ *",-1)),r(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.expense_date=s),type:"date",required:"",class:"input"},null,512),[[b,a.value.expense_date]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium mb-2"},"التكرار *",-1)),r(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.recurrence_type=s),required:"",class:"input"},[...t[40]||(t[40]=[e("option",{value:"once"},"مرة واحدة",-1),e("option",{value:"monthly"},"شهري",-1),e("option",{value:"yearly"},"سنوي",-1)])],512),[[T,a.value.recurrence_type]])])]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium mb-2"},"ملاحظات",-1)),r(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.remarks=s),rows:"3",class:"input",placeholder:"أضف ملاحظات..."},null,512),[[b,a.value.remarks]])]),e("div",Ke,[r(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.is_fixed=s),type:"checkbox",id:"is_fixed",class:"mr-2"},null,512),[[ee,a.value.is_fixed]]),t[43]||(t[43]=e("label",{for:"is_fixed",class:"text-sm font-medium"},"مصروف ثابت",-1))]),e("div",Qe,[e("button",{type:"button",onClick:U,class:"btn btn-secondary flex-1"},"إلغاء"),e("button",We,o(w.value?"تحديث":"حفظ"),1)])],32)])])):M("",!0),h.value?(m(),x("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[15]||(t[15]=z(s=>h.value=!1,["self"]))},[e("div",Ze,[t[48]||(t[48]=e("h3",{class:"text-2xl font-bold mb-4"},"إضافة نوع مصروف",-1)),e("form",{onSubmit:z(G,["prevent"]),class:"space-y-4"},[e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم بالعربية *",-1)),r(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>v.value.name_ar=s),type:"text",required:"",class:"input",placeholder:"مثال: الإيجار"},null,512),[[b,v.value.name_ar]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم بالإنجليزية",-1)),r(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>v.value.name_en=s),type:"text",class:"input",placeholder:"Example: Rent"},null,512),[[b,v.value.name_en]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium mb-2"},"الوصف",-1)),r(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=s=>v.value.description=s),rows:"2",class:"input",placeholder:"وصف نوع المصروف..."},null,512),[[b,v.value.description]])]),e("div",et,[e("button",{type:"button",onClick:t[14]||(t[14]=s=>h.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),t[47]||(t[47]=e("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):M("",!0)]))}};export{pt as default};
