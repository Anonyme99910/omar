import{_ as M,u as X,b as O,r as p,C as R,f as j,c as r,o as d,d as e,k as v,F as T,n as V,x as $,y as S,t as l,e as g,v as f,l as y,m as k,z as D}from"./index-CzkByH-I.js";import{E as q}from"./eye-DMCA4FEx.js";import{D as A}from"./download-DaeOBfWP.js";import{X as H}from"./x-circle-CJA6RIzF.js";import"./createLucideIcon-DWozM5qm.js";const J={class:"invoices-container"},K={class:"tabs"},Q=["onClick"],W={key:0,class:"badge"},Y={class:"filters"},Z={class:"date-filter"},ee={class:"date-filter"},te={class:"table-container"},ae={class:"table-responsive"},se={class:"invoice-number"},le={class:"mobile-info"},ne={class:"hide-mobile"},oe={class:"hide-mobile"},re={class:"amount-cell"},de={class:"mobile-amounts"},ue={key:0},ie={class:"hide-tablet"},ce={class:"hide-tablet"},_e={class:"actions"},pe=["onClick"],ve=["onClick"],me=["onClick"],be={key:0,class:"pagination"},he=["disabled"],ge=["disabled"],fe={__name:"InvoicesList",setup(ye){const z=X(),i=O(),c=p("all"),C=p([]),m=p({}),o=p({search:"",startDate:"",endDate:""}),n=p({current_page:1,last_page:1,per_page:20,total:0}),E=[{label:"الكل",value:"all"},{label:"غير مدفوع",value:"unpaid"},{label:"مدفوع جزئياً",value:"partially_paid"},{label:"مدفوع",value:"paid"},{label:"ملغي",value:"void"}];let b=null;const L=()=>{b&&clearTimeout(b),b=setTimeout(()=>{u(1)},300)},u=async(s=1)=>{try{const a={page:s,status:c.value!=="all"?c.value:void 0,start_date:o.value.startDate||void 0,end_date:o.value.endDate||void 0,search:o.value.search||void 0},t=await D.getSales(a);C.value=t.data.sales.data,m.value=t.data.counts,n.value={current_page:t.data.sales.current_page,last_page:t.data.sales.last_page,per_page:t.data.sales.per_page,total:t.data.sales.total}}catch(a){i.error("فشل تحميل الفواتير"),console.error(a)}},N=s=>{z.push(`/invoices/${s}`)},P=async s=>{try{await D.downloadInvoicePdf(s),i.success("تم تحميل الفاتورة")}catch{i.error("فشل تحميل الفاتورة")}},B=async s=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟"))try{await D.voidSale(s),i.success("تم إلغاء الفاتورة"),u(n.value.current_page)}catch{i.error("فشل إلغاء الفاتورة")}},w=s=>{u(s)},G=()=>{o.value={search:"",startDate:"",endDate:""},u()},I=s=>new Date(s).toLocaleDateString("en-GB"),_=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,a=>"٠١٢٣٤٥٦٧٨٩".indexOf(a)),U=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s;return R(c,()=>{u()}),j(()=>{u()}),(s,a)=>(d(),r("div",J,[a[8]||(a[8]=e("div",{class:"header"},[e("h1",null,"الفواتير")],-1)),e("div",K,[(d(),r(T,null,V(E,t=>e("button",{key:t.value,class:$(["tab",{active:c.value===t.value}]),onClick:h=>c.value=t.value},[S(l(t.label)+" ",1),m.value[t.value]?(d(),r("span",W,l(m.value[t.value]),1)):v("",!0)],10,Q)),64))]),e("div",Y,[g(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.search=t),type:"text",placeholder:"بحث برقم الفاتورة، العميل، أو الهاتف...",class:"search-input",onInput:L},null,544),[[f,o.value.search]]),e("div",Z,[a[5]||(a[5]=e("label",null,"من تاريخ:",-1)),g(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.startDate=t),type:"date",class:"date-input"},null,512),[[f,o.value.startDate]])]),e("div",ee,[a[6]||(a[6]=e("label",null,"إلى تاريخ:",-1)),g(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.endDate=t),type:"date",class:"date-input"},null,512),[[f,o.value.endDate]])]),e("button",{onClick:u,class:"btn-primary"},"بحث"),e("button",{onClick:G,class:"btn-secondary"},"مسح الفلاتر")]),e("div",te,[e("div",ae,[e("table",null,[a[7]||(a[7]=e("thead",null,[e("tr",null,[e("th",null,"رقم الفاتورة"),e("th",{class:"hide-mobile"},"العميل"),e("th",{class:"hide-mobile"},"التاريخ"),e("th",null,"الإجمالي"),e("th",{class:"hide-tablet"},"المدفوع"),e("th",{class:"hide-tablet"},"المتبقي"),e("th",null,"الحالة"),e("th",null,"الإجراءات")])],-1)),e("tbody",null,[(d(!0),r(T,null,V(C.value,t=>{var h,x;return d(),r("tr",{key:t.id},[e("td",null,[e("div",se,l(t.invoice_number),1),e("div",le,[e("small",null,l(((h=t.customer)==null?void 0:h.name)||"عميل عادي"),1),e("small",null,l(I(t.issue_date||t.created_at)),1)])]),e("td",ne,l(((x=t.customer)==null?void 0:x.name)||"عميل عادي"),1),e("td",oe,l(I(t.issue_date||t.created_at)),1),e("td",null,[e("div",re,[S(l(_(t.total))+" ",1),e("div",de,[e("small",null,"مدفوع: "+l(_(t.paid_sum)),1),t.balance_due>0?(d(),r("small",ue,"متبقي: "+l(_(t.balance_due)),1)):v("",!0)])])]),e("td",ie,l(_(t.paid_sum)),1),e("td",ce,l(_(t.balance_due)),1),e("td",null,[e("span",{class:$(["status-badge",t.status])},l(U(t.status)),3)]),e("td",_e,[e("button",{onClick:F=>N(t.id),class:"btn-icon",title:"عرض"},[y(k(q),{size:18})],8,pe),e("button",{onClick:F=>P(t.id),class:"btn-icon hide-mobile",title:"تحميل PDF"},[y(k(A),{size:18})],8,ve),t.status!=="void"?(d(),r("button",{key:0,onClick:F=>B(t.id),class:"btn-icon btn-danger hide-mobile",title:"إلغاء"},[y(k(H),{size:18})],8,me)):v("",!0)])])}),128))])])])]),n.value.total>n.value.per_page?(d(),r("div",be,[e("button",{onClick:a[3]||(a[3]=t=>w(n.value.current_page-1)),disabled:n.value.current_page===1,class:"btn-secondary"}," السابق ",8,he),e("span",null,"صفحة "+l(n.value.current_page)+" من "+l(n.value.last_page),1),e("button",{onClick:a[4]||(a[4]=t=>w(n.value.current_page+1)),disabled:n.value.current_page===n.value.last_page,class:"btn-secondary"}," التالي ",8,ge)])):v("",!0)]))}},xe=M(fe,[["__scopeId","data-v-5791f94e"]]);export{xe as default};
