import{b as K,r as p,g as Q,h as W,c as x,o as m,d as t,j as $,k as c,x as D,l as y,t as o,e as r,v as g,z,F as L,m as M,s as Z,w as T,A as ee,y as _}from"./index-eIO0F-EA.js";import{P as R}from"./plus-CbB93gte.js";import{R as te}from"./receipt-CYy0UFLx.js";import{c as N}from"./createLucideIcon-Cg-DwzIY.js";import{T as se}from"./trending-up-Bv2hURbL.js";import{D as le}from"./download-DFs4UFNa.js";import{X as ne}from"./x-Br8cfar4.js";import{P as ae}from"./pen-CeRcKiFq.js";import{T as oe}from"./trash-2-DEuS8yT-.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=N("CalendarIcon",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=N("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),de={class:"space-y-6"},ue={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},pe={class:"flex gap-3"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},me={class:"card bg-gradient-to-br from-blue-500 to-blue-600 text-white"},ce={class:"flex items-center justify-between"},ye={class:"text-3xl font-bold"},ve={class:"text-blue-100 text-xs mt-1"},fe={class:"card bg-gradient-to-br from-green-500 to-green-600 text-white"},be={class:"flex items-center justify-between"},ge={class:"text-3xl font-bold"},_e={class:"card bg-gradient-to-br from-purple-500 to-purple-600 text-white"},we={class:"flex items-center justify-between"},ke={class:"text-3xl font-bold"},he={class:"card bg-gradient-to-br from-orange-500 to-orange-600 text-white"},Ee={class:"flex items-center justify-between"},Ce={class:"text-3xl font-bold"},Fe={class:"card"},Se={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},De=["value"],ze={class:"flex gap-3 mt-4"},Te={class:"card overflow-hidden"},Ve={class:"overflow-x-auto"},Ue={class:"w-full"},$e={class:"divide-y divide-gray-200"},Le={class:"px-6 py-4 whitespace-nowrap text-sm"},Me={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"text-sm font-medium"},je={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"text-lg font-bold text-red-600"},Re={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate"},qe={class:"px-6 py-4 whitespace-nowrap text-sm"},Ae={class:"flex gap-2"},Be=["onClick"],Ge=["onClick"],Oe={key:0},Ye={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Xe={class:"text-2xl font-bold mb-4"},He={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Je=["value"],Ke={class:"flex items-center"},Qe={class:"flex gap-3 pt-2"},We={type:"submit",class:"btn btn-primary flex-1"},Ze={class:"bg-white rounded-xl p-6 w-full max-w-md"},et={class:"flex gap-3 pt-2"},pt={__name:"ExpensesList",setup(tt){const i=K(),w=p([]),V=p([]),d=p({total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0}),E=p(!1),h=p(!1),k=p(!1),C=p(null),n=p({start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""}),a=p({expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1}),v=p({name_ar:"",name_en:"",description:""}),q=Q(()=>{const l=new Date(n.value.start_date).toLocaleDateString("ar-EG",{month:"long",day:"numeric"}),e=new Date(n.value.end_date).toLocaleDateString("ar-EG",{month:"long",day:"numeric"});return`${l} - ${e}`}),f=async()=>{var l;try{const e={};n.value.start_date&&(e.start_date=n.value.start_date),n.value.end_date&&(e.end_date=n.value.end_date),n.value.expense_type_id&&(e.expense_type_id=n.value.expense_type_id),n.value.recurrence_type&&(e.recurrence_type=n.value.recurrence_type),console.log("Fetching expenses with params:",e);const s=await _.getExpenses(e);console.log("API Response:",s.data),w.value=s.data.data||s.data||[],console.log("Expenses loaded:",w.value.length,w.value)}catch(e){console.error("Failed to fetch expenses:",e),console.error("Error details:",(l=e.response)==null?void 0:l.data),i.error("فشل تحميل المصروفات")}},P=async()=>{try{const l=await _.getExpenseTypes();V.value=l.data.data||[]}catch(l){console.error("Failed to fetch expense types:",l)}},F=async()=>{try{const l={};n.value.start_date&&(l.start_date=n.value.start_date),n.value.end_date&&(l.end_date=n.value.end_date);const e=await _.getExpenseStatistics(l);d.value=e.data.data||{total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0},console.log("Statistics:",d.value)}catch(l){console.error("Failed to fetch statistics:",l)}},A=()=>{k.value=!1,C.value=null,a.value={expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1},E.value=!0},B=l=>{k.value=!0,C.value=l.id,a.value={expense_type_id:l.expense_type_id,amount:l.amount,expense_date:l.expense_date,recurrence_type:l.recurrence_type,remarks:l.remarks||"",is_fixed:l.is_fixed},E.value=!0},G=async()=>{try{k.value?(await _.updateExpense(C.value,a.value),i.success("تم تحديث المصروف بنجاح")):(await _.createExpense(a.value),i.success("تم إضافة المصروف بنجاح")),U(),f(),F()}catch(l){console.error("Failed to save expense:",l),i.error("فشل حفظ المصروف")}},O=async l=>{if(confirm("هل أنت متأكد من حذف هذا المصروف؟"))try{await _.deleteExpense(l),i.success("تم حذف المصروف بنجاح"),f(),F()}catch(e){console.error("Failed to delete expense:",e),i.error("فشل حذف المصروف")}},Y=async()=>{try{await _.createExpenseType(v.value),i.success("تم إضافة نوع المصروف بنجاح"),h.value=!1,v.value={name_ar:"",name_en:"",description:""},P()}catch(l){console.error("Failed to save expense type:",l),i.error("فشل حفظ نوع المصروف")}},U=()=>{E.value=!1,k.value=!1,C.value=null},X=()=>{n.value={start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""},f(),F()},H=async()=>{try{const{jsPDF:l}=window.jspdf,e=new l;e.setFontSize(18),e.text("Expenses Report",105,20,{align:"center"}),e.setFontSize(12),e.text(`${n.value.start_date} to ${n.value.end_date}`,105,30,{align:"center"}),e.setFontSize(10),e.text(`Total Expenses: ${u(d.value.total_expenses)}`,20,45),e.text(`Monthly Expenses: ${u(d.value.monthly_expenses)}`,20,52),e.text(`Yearly Expenses: ${u(d.value.yearly_expenses)}`,20,59),e.text(`Fixed Expenses: ${u(d.value.fixed_expenses)}`,20,66);const s=w.value.map(b=>{var S;return[j(b.expense_date),((S=b.expense_type)==null?void 0:S.name_ar)||"N/A",u(b.amount),I(b.recurrence_type),b.remarks||"-"]});e.autoTable({startY:75,head:[["Date","Type","Amount","Recurrence","Remarks"]],body:s,styles:{fontSize:9},headStyles:{fillColor:[59,130,246]}}),e.save(`expenses-${new Date().toISOString().split("T")[0]}.pdf`),i.success("تم تصدير التقرير بنجاح")}catch(l){console.error("PDF export error:",l),i.error("فشل تصدير التقرير")}},u=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0).replace("EGP","ج.م"),j=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),I=l=>({once:"مرة واحدة",monthly:"شهري",yearly:"سنوي"})[l]||l,J=l=>({once:"badge badge-secondary",monthly:"badge badge-primary",yearly:"badge badge-success"})[l]||"badge";return W(()=>{f(),P(),F()}),(l,e)=>(m(),x("div",de,[t("div",ue,[e[18]||(e[18]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"المصروفات"),t("p",{class:"text-gray-600 mt-1"},"إدارة وتتبع جميع المصروفات")],-1)),t("div",pe,[t("button",{onClick:e[0]||(e[0]=s=>h.value=!0),class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(R),{size:20}),e[16]||(e[16]=D(" إضافة نوع مصروف ",-1))]),t("button",{onClick:A,class:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(R),{size:20}),e[17]||(e[17]=D(" إضافة مصروف ",-1))])])]),t("div",xe,[t("div",me,[t("div",ce,[t("div",null,[e[19]||(e[19]=t("p",{class:"text-blue-100 text-sm mb-1"},"إجمالي المصروفات",-1)),t("h3",ye,o(u(d.value.total_expenses)),1),t("p",ve,o(q.value),1)]),c(y(te),{size:48,class:"text-blue-200"})])]),t("div",fe,[t("div",be,[t("div",null,[e[20]||(e[20]=t("p",{class:"text-green-100 text-sm mb-1"},"المصروفات الشهرية",-1)),t("h3",ge,o(u(d.value.monthly_expenses)),1),e[21]||(e[21]=t("p",{class:"text-green-100 text-xs mt-1"},"متكررة شهرياً",-1))]),c(y(re),{size:48,class:"text-green-200"})])]),t("div",_e,[t("div",we,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-purple-100 text-sm mb-1"},"المصروفات السنوية",-1)),t("h3",ke,o(u(d.value.yearly_expenses)),1),e[23]||(e[23]=t("p",{class:"text-purple-100 text-xs mt-1"},"متكررة سنوياً",-1))]),c(y(se),{size:48,class:"text-purple-200"})])]),t("div",he,[t("div",Ee,[t("div",null,[e[24]||(e[24]=t("p",{class:"text-orange-100 text-sm mb-1"},"المصروفات الثابتة",-1)),t("h3",Ce,o(u(d.value.fixed_expenses)),1),e[25]||(e[25]=t("p",{class:"text-orange-100 text-xs mt-1"},"مصروفات ثابتة",-1))]),c(y(ie),{size:48,class:"text-orange-200"})])])]),t("div",Fe,[t("div",Se,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"من تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.start_date=s),type:"date",class:"input",onChange:f},null,544),[[g,n.value.start_date]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"إلى تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.end_date=s),type:"date",class:"input",onChange:f},null,544),[[g,n.value.end_date]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف",-1)),r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.expense_type_id=s),class:"input",onChange:f},[e[28]||(e[28]=t("option",{value:""},"الكل",-1)),(m(!0),x(L,null,M(V.value,s=>(m(),x("option",{key:s.id,value:s.id},o(s.name_ar),9,De))),128))],544),[[z,n.value.expense_type_id]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار",-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.recurrence_type=s),class:"input",onChange:f},[...e[30]||(e[30]=[t("option",{value:""},"الكل",-1),t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],544),[[z,n.value.recurrence_type]])])]),t("div",ze,[t("button",{onClick:H,class:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(le),{size:20}),e[32]||(e[32]=D(" تصدير PDF ",-1))]),t("button",{onClick:X,class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[c(y(ne),{size:20}),e[33]||(e[33]=D(" إعادة تعيين ",-1))])])]),t("div",Te,[t("div",Ve,[t("table",Ue,[e[35]||(e[35]=t("thead",{class:"bg-gray-50 border-b"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التاريخ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"نوع المصروف"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"المبلغ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التكرار"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ملاحظات"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"إجراءات")])],-1)),t("tbody",$e,[(m(!0),x(L,null,M(w.value,s=>{var b;return m(),x("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Le,o(j(s.expense_date)),1),t("td",Me,[t("span",Pe,o(((b=s.expense_type)==null?void 0:b.name_ar)||"غير محدد"),1)]),t("td",je,[t("span",Ie,o(u(s.amount)),1)]),t("td",Re,[t("span",{class:Z(J(s.recurrence_type))},o(I(s.recurrence_type)),3)]),t("td",Ne,o(s.remarks||"-"),1),t("td",qe,[t("div",Ae,[t("button",{onClick:S=>B(s),class:"text-blue-600 hover:text-blue-800"},[c(y(ae),{size:18})],8,Be),t("button",{onClick:S=>O(s.id),class:"text-red-600 hover:text-red-800"},[c(y(oe),{size:18})],8,Ge)])])])}),128)),w.value.length===0?(m(),x("tr",Oe,[...e[34]||(e[34]=[t("td",{colspan:"6",class:"px-6 py-8 text-center text-gray-500"}," لا توجد مصروفات ",-1)])])):$("",!0)])])])]),E.value?(m(),x("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:T(U,["self"])},[t("div",Ye,[t("h3",Xe,o(k.value?"تعديل مصروف":"إضافة مصروف جديد"),1),t("form",{onSubmit:T(G,["prevent"]),class:"space-y-4"},[t("div",He,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف *",-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.expense_type_id=s),required:"",class:"input"},[e[36]||(e[36]=t("option",{value:""},"اختر نوع المصروف",-1)),(m(!0),x(L,null,M(V.value,s=>(m(),x("option",{key:s.id,value:s.id},o(s.name_ar),9,Je))),128))],512),[[z,a.value.expense_type_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium mb-2"},"المبلغ *",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.amount=s),type:"number",step:"0.01",required:"",class:"input",placeholder:"0.00"},null,512),[[g,a.value.amount]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-2"},"التاريخ *",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.expense_date=s),type:"date",required:"",class:"input"},null,512),[[g,a.value.expense_date]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار *",-1)),r(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.recurrence_type=s),required:"",class:"input"},[...e[40]||(e[40]=[t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],512),[[z,a.value.recurrence_type]])])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-2"},"ملاحظات",-1)),r(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.remarks=s),rows:"3",class:"input",placeholder:"أضف ملاحظات..."},null,512),[[g,a.value.remarks]])]),t("div",Ke,[r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.is_fixed=s),type:"checkbox",id:"is_fixed",class:"mr-2"},null,512),[[ee,a.value.is_fixed]]),e[43]||(e[43]=t("label",{for:"is_fixed",class:"text-sm font-medium"},"مصروف ثابت",-1))]),t("div",Qe,[t("button",{type:"button",onClick:U,class:"btn btn-secondary flex-1"},"إلغاء"),t("button",We,o(k.value?"تحديث":"حفظ"),1)])],32)])])):$("",!0),h.value?(m(),x("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[15]||(e[15]=T(s=>h.value=!1,["self"]))},[t("div",Ze,[e[48]||(e[48]=t("h3",{class:"text-2xl font-bold mb-4"},"إضافة نوع مصروف",-1)),t("form",{onSubmit:T(Y,["prevent"]),class:"space-y-4"},[t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالعربية *",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>v.value.name_ar=s),type:"text",required:"",class:"input",placeholder:"مثال: الإيجار"},null,512),[[g,v.value.name_ar]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالإنجليزية",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>v.value.name_en=s),type:"text",class:"input",placeholder:"Example: Rent"},null,512),[[g,v.value.name_en]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium mb-2"},"الوصف",-1)),r(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>v.value.description=s),rows:"2",class:"input",placeholder:"وصف نوع المصروف..."},null,512),[[g,v.value.description]])]),t("div",et,[t("button",{type:"button",onClick:e[14]||(e[14]=s=>h.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e[47]||(e[47]=t("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):$("",!0)]))}};export{pt as default};
