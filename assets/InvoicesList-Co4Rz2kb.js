import{_ as X,u as O,b as R,r as i,C as j,f as q,c as r,o as u,d as e,k as c,F as T,n as V,x as $,y as z,t as l,e as y,v as k,l as D,m as C,z as w}from"./index-D07TEuVv.js";import{E as A}from"./eye-DEPMPUOv.js";import{D as H}from"./download-DQABD286.js";import{X as J}from"./x-circle-CTsRr-LU.js";import"./createLucideIcon-BpdS0zN4.js";const K={class:"invoices-container"},Q={class:"tabs"},W=["onClick"],Y={key:0,class:"badge"},Z={class:"filters"},ee={class:"search-wrapper"},te={key:0,class:"search-spinner"},ae={key:1,class:"search-results-count"},se={class:"date-filter"},le={class:"date-filter"},ne={class:"table-container"},oe={class:"table-responsive"},re={class:"invoice-number"},ue={class:"mobile-info"},de={class:"hide-mobile"},ie={class:"hide-mobile"},ce={class:"amount-cell"},_e={class:"mobile-amounts"},pe={key:0},ve={class:"hide-tablet"},be={class:"hide-tablet"},me={class:"actions"},he=["onClick"],ge=["onClick"],fe=["onClick"],ye={key:0,class:"pagination"},ke=["disabled"],De=["disabled"],Ce={__name:"InvoicesList",setup(we){const E=O(),_=R(),p=i("all"),m=i([]),h=i({}),b=i(!1),n=i({search:"",startDate:"",endDate:""}),o=i({current_page:1,last_page:1,per_page:20,total:0}),L=[{label:"الكل",value:"all"},{label:"غير مدفوع",value:"unpaid"},{label:"مدفوع جزئياً",value:"partially_paid"},{label:"مدفوع",value:"paid"},{label:"ملغي",value:"void"}];let g=null;const N=()=>{g&&clearTimeout(g),b.value=!0,g=setTimeout(()=>{d(1)},200)},d=async(s=1)=>{try{const a={page:s,status:p.value!=="all"?p.value:void 0,start_date:n.value.startDate||void 0,end_date:n.value.endDate||void 0,search:n.value.search||void 0},t=await w.getSales(a);m.value=t.data.sales.data,h.value=t.data.counts,o.value={current_page:t.data.sales.current_page,last_page:t.data.sales.last_page,per_page:t.data.sales.per_page,total:t.data.sales.total}}catch(a){_.error("فشل تحميل الفواتير"),console.error(a)}finally{b.value=!1}},P=s=>{E.push(`/invoices/${s}`)},B=async s=>{try{await w.downloadInvoicePdf(s),_.success("تم تحميل الفاتورة")}catch{_.error("فشل تحميل الفاتورة")}},G=async s=>{if(confirm("هل أنت متأكد من إلغاء هذه الفاتورة؟"))try{await w.voidSale(s),_.success("تم إلغاء الفاتورة"),d(o.value.current_page)}catch{_.error("فشل إلغاء الفاتورة")}},I=s=>{d(s)},U=()=>{n.value={search:"",startDate:"",endDate:""},d()},x=s=>new Date(s).toLocaleDateString("en-GB"),v=s=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP",minimumFractionDigits:2}).format(s).replace(/[٠-٩]/g,a=>"٠١٢٣٤٥٦٧٨٩".indexOf(a)),M=s=>({draft:"مسودة",issued:"صادر",partially_paid:"مدفوع جزئياً",paid:"مدفوع",void:"ملغي"})[s]||s;return j(p,()=>{d()}),q(()=>{d()}),(s,a)=>(u(),r("div",K,[a[9]||(a[9]=e("div",{class:"header"},[e("h1",null,"الفواتير")],-1)),e("div",Q,[(u(),r(T,null,V(L,t=>e("button",{key:t.value,class:$(["tab",{active:p.value===t.value}]),onClick:f=>p.value=t.value},[z(l(t.label)+" ",1),h.value[t.value]?(u(),r("span",Y,l(h.value[t.value]),1)):c("",!0)],10,W)),64))]),e("div",Z,[e("div",ee,[y(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>n.value.search=t),type:"text",placeholder:"بحث ذكي: رقم الفاتورة، اسم العميل، أو رقم الهاتف...",class:"search-input",onInput:N},null,544),[[k,n.value.search]]),b.value?(u(),r("div",te,[...a[5]||(a[5]=[e("div",{class:"spinner"},null,-1)])])):c("",!0),n.value.search&&!b.value?(u(),r("div",ae,l(m.value.length)+" نتيجة ",1)):c("",!0)]),e("div",se,[a[6]||(a[6]=e("label",null,"من تاريخ:",-1)),y(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.startDate=t),type:"date",class:"date-input"},null,512),[[k,n.value.startDate]])]),e("div",le,[a[7]||(a[7]=e("label",null,"إلى تاريخ:",-1)),y(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>n.value.endDate=t),type:"date",class:"date-input"},null,512),[[k,n.value.endDate]])]),e("button",{onClick:d,class:"btn-primary"},"بحث"),e("button",{onClick:U,class:"btn-secondary"},"مسح الفلاتر")]),e("div",ne,[e("div",oe,[e("table",null,[a[8]||(a[8]=e("thead",null,[e("tr",null,[e("th",null,"رقم الفاتورة"),e("th",{class:"hide-mobile"},"العميل"),e("th",{class:"hide-mobile"},"التاريخ"),e("th",null,"الإجمالي"),e("th",{class:"hide-tablet"},"المدفوع"),e("th",{class:"hide-tablet"},"المتبقي"),e("th",null,"الحالة"),e("th",null,"الإجراءات")])],-1)),e("tbody",null,[(u(!0),r(T,null,V(m.value,t=>{var f,F;return u(),r("tr",{key:t.id},[e("td",null,[e("div",re,l(t.invoice_number),1),e("div",ue,[e("small",null,l(((f=t.customer)==null?void 0:f.name)||"عميل عادي"),1),e("small",null,l(x(t.issue_date||t.created_at)),1)])]),e("td",de,l(((F=t.customer)==null?void 0:F.name)||"عميل عادي"),1),e("td",ie,l(x(t.issue_date||t.created_at)),1),e("td",null,[e("div",ce,[z(l(v(t.total))+" ",1),e("div",_e,[e("small",null,"مدفوع: "+l(v(t.paid_sum)),1),t.balance_due>0?(u(),r("small",pe,"متبقي: "+l(v(t.balance_due)),1)):c("",!0)])])]),e("td",ve,l(v(t.paid_sum)),1),e("td",be,l(v(t.balance_due)),1),e("td",null,[e("span",{class:$(["status-badge",t.status])},l(M(t.status)),3)]),e("td",me,[e("button",{onClick:S=>P(t.id),class:"btn-icon",title:"عرض"},[D(C(A),{size:18})],8,he),e("button",{onClick:S=>B(t.id),class:"btn-icon hide-mobile",title:"تحميل PDF"},[D(C(H),{size:18})],8,ge),t.status!=="void"?(u(),r("button",{key:0,onClick:S=>G(t.id),class:"btn-icon btn-danger hide-mobile",title:"إلغاء"},[D(C(J),{size:18})],8,fe)):c("",!0)])])}),128))])])])]),o.value.total>o.value.per_page?(u(),r("div",ye,[e("button",{onClick:a[3]||(a[3]=t=>I(o.value.current_page-1)),disabled:o.value.current_page===1,class:"btn-secondary"}," السابق ",8,ke),e("span",null,"صفحة "+l(o.value.current_page)+" من "+l(o.value.last_page),1),e("button",{onClick:a[4]||(a[4]=t=>I(o.value.current_page+1)),disabled:o.value.current_page===o.value.last_page,class:"btn-secondary"}," التالي ",8,De)])):c("",!0)]))}},Ve=X(Ce,[["__scopeId","data-v-64f9558b"]]);export{Ve as default};
