import{b as N,u as T,r as i,g as j,h as q,c as b,o as f,d as e,j as P,e as v,v as g,k as y,y as B,l as m,F as D,m as F,t as n,s as I,w as L,A,z as x}from"./index-Bys7CUgV.js";import{t as k,f as Q}from"./numbers-BTmV-EI5.js";import{P as R}from"./plus-cXaTAy61.js";import{E as G}from"./eye-CMNkNUs-.js";import{P as H}from"./pen-square-Bl24m8fd.js";import{T as J}from"./trash-2-gugkMUeW.js";import"./createLucideIcon-CnMfVSME.js";const K={class:"space-y-6"},O={class:"flex justify-between items-center"},W={class:"card overflow-hidden"},X={class:"table"},Y={class:"font-medium"},Z={class:"font-mono"},ee={class:"font-bold text-green-600"},te={class:"flex items-center gap-2"},se=["onClick"],oe=["onClick"],le=["onClick"],ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ae={class:"bg-white rounded-xl p-6 w-full max-w-md"},re={class:"text-2xl font-bold mb-6"},ue={class:"flex gap-3 justify-end mt-6"},de={type:"submit",class:"btn btn-primary"},ye={__name:"Customers",setup(ie){const a=N(),_=T(),r=i([]),c=i(""),h=i(!1),u=i(!1),p=i(null),l=i({name:"",phone:"",address:"",segment:"قطاعي"}),V=j(()=>c.value?r.value.filter(o=>o.name.includes(c.value)||o.phone.includes(c.value)):r.value),z=o=>Q(o),M=o=>{_.push(`/clients/${o}`)},C=async()=>{try{const o=await x.getCustomers({per_page:100});r.value=o.data.data||o.data}catch(o){a.error("فشل تحميل العملاء"),console.error(o)}},U=async()=>{var o;try{const t={name:l.value.name,phone:l.value.phone,address:l.value.address,segment:l.value.segment};if(console.log("Submitting customer form:",t),u.value){console.log("Updating customer ID:",p.value);const s=await x.updateCustomer(p.value,t);console.log("Update response:",s.data);const d=r.value.findIndex(E=>E.id===p.value);d!==-1&&(r.value[d]={...r.value[d],...s.data}),a.success("تم تحديث العميل بنجاح")}else{const s=await x.createCustomer(t);console.log("Create response:",s.data),a.success("تم إضافة العميل بنجاح")}w(),await C()}catch(t){console.error("Submit error:",t),console.error("Error response:",(o=t.response)==null?void 0:o.data),a.error("حدث خطأ")}},$=o=>{l.value={...o},p.value=o.id,u.value=!0},S=async o=>{if(confirm("هل أنت متأكد من حذف هذا العميل؟"))try{await x.deleteCustomer(o),a.success("تم حذف العميل بنجاح"),C()}catch{a.error("فشل حذف العميل")}},w=()=>{h.value=!1,u.value=!1,p.value=null,l.value={name:"",phone:"",address:"",segment:"قطاعي"}};return q(()=>{C()}),(o,t)=>(f(),b("div",K,[e("div",O,[v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),type:"text",placeholder:"البحث عن عميل...",class:"input w-80"},null,512),[[g,c.value]]),e("button",{onClick:t[1]||(t[1]=s=>h.value=!0),class:"btn btn-primary flex items-center gap-2"},[y(m(R),{size:20}),t[6]||(t[6]=B(" إضافة عميل ",-1))])]),e("div",W,[e("table",X,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"الاسم"),e("th",null,"الهاتف"),e("th",null,"الشريحة"),e("th",null,"إجمالي المشتريات"),e("th",null,"عدد الطلبات"),e("th",null,"الإجراءات")])],-1)),e("tbody",null,[(f(!0),b(D,null,F(V.value,s=>(f(),b("tr",{key:`customer-${s.id}-${s.segment}`},[e("td",Y,n(s.name),1),e("td",Z,n(m(k)(s.phone)),1),e("td",null,[e("span",{class:I(["badge",s.segment==="جملة"?"badge-success":s.segment==="قطاعي"?"badge-primary":"badge-warning"])},n(s.segment||"قطاعي"),3)]),e("td",ee,n(z(s.total_purchases)),1),e("td",null,n(m(k)(s.total_orders)),1),e("td",null,[e("div",te,[e("button",{onClick:d=>M(s.id),class:"text-gray-700 hover:text-gray-900"},[y(m(G),{size:18})],8,se),e("button",{onClick:d=>$(s),class:"text-blue-600 hover:text-blue-800"},[y(m(H),{size:18})],8,oe),e("button",{onClick:d=>S(s.id),class:"text-red-600 hover:text-red-800"},[y(m(J),{size:18})],8,le)])])]))),128))])])]),h.value||u.value?(f(),b("div",ne,[e("div",ae,[e("h3",re,n(u.value?"تعديل عميل":"إضافة عميل جديد"),1),e("form",{onSubmit:L(U,["prevent"]),class:"space-y-4"},[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.name=s),type:"text",required:"",class:"input"},null,512),[[g,l.value.name]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium mb-2"},"الهاتف",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.phone=s),type:"tel",required:"",class:"input"},null,512),[[g,l.value.phone]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium mb-2"},"العنوان",-1)),v(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.address=s),rows:"3",class:"input"},null,512),[[g,l.value.address]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium mb-2"},"الشريحة",-1)),v(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.segment=s),class:"input",required:""},[...t[11]||(t[11]=[e("option",{value:"جملة"},"جملة",-1),e("option",{value:"قطاعي"},"قطاعي",-1),e("option",{value:"صفحة"},"صفحة",-1)])],512),[[A,l.value.segment]])]),e("div",ue,[e("button",{type:"button",onClick:w,class:"btn btn-secondary"},"إلغاء"),e("button",de,n(u.value?"تحديث":"إضافة"),1)])],32)])])):P("",!0)]))}};export{ye as default};
