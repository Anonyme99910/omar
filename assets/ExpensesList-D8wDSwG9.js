import{b as W,r as c,g as Z,h as ee,c as m,o as x,d as t,j as L,k as y,x as U,l as v,t as o,e as r,v as b,z as V,F as j,m as I,s as te,w as T,A as se,y as _}from"./index-BFrhup2P.js";import{P as q}from"./plus-cjWZ-8w8.js";import{R as le}from"./receipt-cocTtZhq.js";import{c as B}from"./createLucideIcon-K7_hsKmS.js";import{T as ne}from"./trending-up-DgLWWu6-.js";import{D as ae}from"./download-CqO8c-mc.js";import{X as oe}from"./x-e52qqR1C.js";import{P as re}from"./pen-CALtYuVS.js";import{T as ie}from"./trash-2-Bx_7iOfn.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=B("CalendarIcon",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=B("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),pe={class:"space-y-6"},ce={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},me={class:"flex gap-3"},xe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},ye={class:"card bg-gradient-to-br from-blue-500 to-blue-600 text-white"},ve={class:"flex items-center justify-between"},fe={class:"text-3xl font-bold"},ge={class:"text-blue-100 text-xs mt-1"},be={class:"card bg-gradient-to-br from-green-500 to-green-600 text-white"},_e={class:"flex items-center justify-between"},we={class:"text-3xl font-bold"},ke={class:"card bg-gradient-to-br from-purple-500 to-purple-600 text-white"},he={class:"flex items-center justify-between"},Se={class:"text-3xl font-bold"},Ce={class:"card bg-gradient-to-br from-orange-500 to-orange-600 text-white"},Ee={class:"flex items-center justify-between"},Fe={class:"text-3xl font-bold"},ze={class:"card"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ue=["value"],Ve={class:"flex gap-3 mt-4"},Te={class:"card overflow-hidden"},$e={class:"overflow-x-auto"},Pe={class:"w-full"},Le={class:"divide-y divide-gray-200"},je={class:"px-6 py-4 whitespace-nowrap text-sm"},Ie={class:"px-6 py-4 whitespace-nowrap"},Me={class:"text-sm font-medium"},Re={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"text-lg font-bold text-red-600"},qe={class:"px-6 py-4 whitespace-nowrap"},Be={class:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm"},Ae={class:"flex gap-2"},Ge=["onClick"],Xe=["onClick"],Ye={key:0},He={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Je={class:"text-2xl font-bold mb-4"},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe=["value"],We={class:"flex items-center"},Ze={class:"flex gap-3 pt-2"},et={type:"submit",class:"btn btn-primary flex-1"},tt={class:"bg-white rounded-xl p-6 w-full max-w-md"},st={class:"flex gap-3 pt-2"},mt={__name:"ExpensesList",setup(lt){const d=W(),w=c([]),$=c([]),u=c({total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0}),S=c(!1),h=c(!1),k=c(!1),C=c(null),n=c({start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""}),a=c({expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1}),f=c({name_ar:"",name_en:"",description:""}),O=Z(()=>{const l=new Date(n.value.start_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),e=new Date(n.value.end_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});return`${l} - ${e}`}),g=async()=>{var l;try{const e={};n.value.start_date&&(e.start_date=n.value.start_date),n.value.end_date&&(e.end_date=n.value.end_date),n.value.expense_type_id&&(e.expense_type_id=n.value.expense_type_id),n.value.recurrence_type&&(e.recurrence_type=n.value.recurrence_type),console.log("Fetching expenses with params:",e);const s=await _.getExpenses(e);console.log("API Response:",s.data),w.value=s.data.data||s.data||[],console.log("Expenses loaded:",w.value.length,w.value)}catch(e){console.error("Failed to fetch expenses:",e),console.error("Error details:",(l=e.response)==null?void 0:l.data),d.error("فشل تحميل المصروفات")}},M=async()=>{try{const l=await _.getExpenseTypes();$.value=l.data.data||[]}catch(l){console.error("Failed to fetch expense types:",l)}},E=async()=>{try{const l={};n.value.start_date&&(l.start_date=n.value.start_date),n.value.end_date&&(l.end_date=n.value.end_date);const e=await _.getExpenseStatistics(l);u.value=e.data.data||{total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0},console.log("Statistics:",u.value)}catch(l){console.error("Failed to fetch statistics:",l)}},A=()=>{k.value=!1,C.value=null,a.value={expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1},S.value=!0},G=l=>{k.value=!0,C.value=l.id,a.value={expense_type_id:l.expense_type_id,amount:l.amount,expense_date:l.expense_date,recurrence_type:l.recurrence_type,remarks:l.remarks||"",is_fixed:l.is_fixed},S.value=!0},X=async()=>{try{k.value?(await _.updateExpense(C.value,a.value),d.success("تم تحديث المصروف بنجاح")):(await _.createExpense(a.value),d.success("تم إضافة المصروف بنجاح")),P(),g(),E()}catch(l){console.error("Failed to save expense:",l),d.error("فشل حفظ المصروف")}},Y=async l=>{if(confirm("هل أنت متأكد من حذف هذا المصروف؟"))try{await _.deleteExpense(l),d.success("تم حذف المصروف بنجاح"),g(),E()}catch(e){console.error("Failed to delete expense:",e),d.error("فشل حذف المصروف")}},H=async()=>{try{await _.createExpenseType(f.value),d.success("تم إضافة نوع المصروف بنجاح"),h.value=!1,f.value={name_ar:"",name_en:"",description:""},M()}catch(l){console.error("Failed to save expense type:",l),d.error("فشل حفظ نوع المصروف")}},P=()=>{S.value=!1,k.value=!1,C.value=null},J=()=>{n.value={start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""},g(),E()},K=async()=>{try{const{jsPDF:l}=window.jspdf,e=new l;e.setFontSize(20),e.text("تقرير المصروفات",105,20,{align:"center"}),e.setFontSize(12),e.text(`الفترة: ${n.value.start_date} الى ${n.value.end_date}`,105,32,{align:"center"}),e.setFontSize(11),[`اجمالي المصروفات: ${p(u.value.total_expenses)}`,`المصروفات الشهرية: ${p(u.value.monthly_expenses)}`,`المصروفات السنوية: ${p(u.value.yearly_expenses)}`,`المصروفات الثابتة: ${p(u.value.fixed_expenses)}`].forEach((i,D)=>{e.text(i,105,48+D*8,{align:"center"})});const F=w.value.map(i=>{var D;return[R(i.expense_date),((D=i.expense_type)==null?void 0:D.name_ar)||"-",p(i.amount),N(i.recurrence_type),i.remarks||"-"]});e.autoTable({startY:85,head:[["التاريخ","نوع المصروف","المبلغ","التكرار","ملاحظات"]],body:F,styles:{fontSize:10,halign:"center",font:"helvetica"},headStyles:{fillColor:[59,130,246],textColor:255,fontSize:11,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,247,250]},margin:{top:85,left:15,right:15}});const z=e.internal.getNumberOfPages();for(let i=1;i<=z;i++)e.setPage(i),e.setFontSize(9),e.text(`صفحة ${i} من ${z}`,105,e.internal.pageSize.height-10,{align:"center"});e.save(`expenses-${new Date().toISOString().split("T")[0]}.pdf`),d.success("تم تصدير التقرير بنجاح")}catch(l){console.error("PDF export error:",l),d.error("فشل تصدير التقرير")}},p=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}).format(l||0).replace("EGP","ج.م"),R=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),N=l=>({once:"مرة واحدة",monthly:"شهري",yearly:"سنوي"})[l]||l,Q=l=>({once:"badge badge-secondary",monthly:"badge badge-primary",yearly:"badge badge-success"})[l]||"badge";return ee(()=>{g(),M(),E()}),(l,e)=>(x(),m("div",pe,[t("div",ce,[e[18]||(e[18]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"المصروفات"),t("p",{class:"text-gray-600 mt-1"},"إدارة وتتبع جميع المصروفات")],-1)),t("div",me,[t("button",{onClick:e[0]||(e[0]=s=>h.value=!0),class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(q),{size:20}),e[16]||(e[16]=U(" إضافة نوع مصروف ",-1))]),t("button",{onClick:A,class:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(q),{size:20}),e[17]||(e[17]=U(" إضافة مصروف ",-1))])])]),t("div",xe,[t("div",ye,[t("div",ve,[t("div",null,[e[19]||(e[19]=t("p",{class:"text-blue-100 text-sm mb-1"},"إجمالي المصروفات",-1)),t("h3",fe,o(p(u.value.total_expenses)),1),t("p",ge,o(O.value),1)]),y(v(le),{size:48,class:"text-blue-200"})])]),t("div",be,[t("div",_e,[t("div",null,[e[20]||(e[20]=t("p",{class:"text-green-100 text-sm mb-1"},"المصروفات الشهرية",-1)),t("h3",we,o(p(u.value.monthly_expenses)),1),e[21]||(e[21]=t("p",{class:"text-green-100 text-xs mt-1"},"متكررة شهرياً",-1))]),y(v(de),{size:48,class:"text-green-200"})])]),t("div",ke,[t("div",he,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-purple-100 text-sm mb-1"},"المصروفات السنوية",-1)),t("h3",Se,o(p(u.value.yearly_expenses)),1),e[23]||(e[23]=t("p",{class:"text-purple-100 text-xs mt-1"},"متكررة سنوياً",-1))]),y(v(ne),{size:48,class:"text-purple-200"})])]),t("div",Ce,[t("div",Ee,[t("div",null,[e[24]||(e[24]=t("p",{class:"text-orange-100 text-sm mb-1"},"المصروفات الثابتة",-1)),t("h3",Fe,o(p(u.value.fixed_expenses)),1),e[25]||(e[25]=t("p",{class:"text-orange-100 text-xs mt-1"},"مصروفات ثابتة",-1))]),y(v(ue),{size:48,class:"text-orange-200"})])])]),t("div",ze,[t("div",De,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"من تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.start_date=s),type:"date",class:"input",onChange:g},null,544),[[b,n.value.start_date]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium mb-2"},"إلى تاريخ",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.end_date=s),type:"date",class:"input",onChange:g},null,544),[[b,n.value.end_date]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف",-1)),r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.expense_type_id=s),class:"input",onChange:g},[e[28]||(e[28]=t("option",{value:""},"الكل",-1)),(x(!0),m(j,null,I($.value,s=>(x(),m("option",{key:s.id,value:s.id},o(s.name_ar),9,Ue))),128))],544),[[V,n.value.expense_type_id]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار",-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.recurrence_type=s),class:"input",onChange:g},[...e[30]||(e[30]=[t("option",{value:""},"الكل",-1),t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],544),[[V,n.value.recurrence_type]])])]),t("div",Ve,[t("button",{onClick:K,class:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(ae),{size:20}),e[32]||(e[32]=U(" تصدير PDF ",-1))]),t("button",{onClick:J,class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[y(v(oe),{size:20}),e[33]||(e[33]=U(" إعادة تعيين ",-1))])])]),t("div",Te,[t("div",$e,[t("table",Pe,[e[35]||(e[35]=t("thead",{class:"bg-gray-50 border-b"},[t("tr",null,[t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التاريخ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"نوع المصروف"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"المبلغ"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التكرار"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ملاحظات"),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"إجراءات")])],-1)),t("tbody",Le,[(x(!0),m(j,null,I(w.value,s=>{var F;return x(),m("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",je,o(R(s.expense_date)),1),t("td",Ie,[t("span",Me,o(((F=s.expense_type)==null?void 0:F.name_ar)||"غير محدد"),1)]),t("td",Re,[t("span",Ne,o(p(s.amount)),1)]),t("td",qe,[t("span",{class:te(Q(s.recurrence_type))},o(N(s.recurrence_type)),3)]),t("td",Be,o(s.remarks||"-"),1),t("td",Oe,[t("div",Ae,[t("button",{onClick:z=>G(s),class:"text-blue-600 hover:text-blue-800"},[y(v(re),{size:18})],8,Ge),t("button",{onClick:z=>Y(s.id),class:"text-red-600 hover:text-red-800"},[y(v(ie),{size:18})],8,Xe)])])])}),128)),w.value.length===0?(x(),m("tr",Ye,[...e[34]||(e[34]=[t("td",{colspan:"6",class:"px-6 py-8 text-center text-gray-500"}," لا توجد مصروفات ",-1)])])):L("",!0)])])])]),S.value?(x(),m("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:T(P,["self"])},[t("div",He,[t("h3",Je,o(k.value?"تعديل مصروف":"إضافة مصروف جديد"),1),t("form",{onSubmit:T(X,["prevent"]),class:"space-y-4"},[t("div",Ke,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف *",-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.expense_type_id=s),required:"",class:"input"},[e[36]||(e[36]=t("option",{value:""},"اختر نوع المصروف",-1)),(x(!0),m(j,null,I($.value,s=>(x(),m("option",{key:s.id,value:s.id},o(s.name_ar),9,Qe))),128))],512),[[V,a.value.expense_type_id]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium mb-2"},"المبلغ *",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.amount=s),type:"number",step:"0.01",required:"",class:"input",placeholder:"0.00"},null,512),[[b,a.value.amount]])]),t("div",null,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium mb-2"},"التاريخ *",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.expense_date=s),type:"date",required:"",class:"input"},null,512),[[b,a.value.expense_date]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium mb-2"},"التكرار *",-1)),r(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.recurrence_type=s),required:"",class:"input"},[...e[40]||(e[40]=[t("option",{value:"once"},"مرة واحدة",-1),t("option",{value:"monthly"},"شهري",-1),t("option",{value:"yearly"},"سنوي",-1)])],512),[[V,a.value.recurrence_type]])])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium mb-2"},"ملاحظات",-1)),r(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.remarks=s),rows:"3",class:"input",placeholder:"أضف ملاحظات..."},null,512),[[b,a.value.remarks]])]),t("div",We,[r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.is_fixed=s),type:"checkbox",id:"is_fixed",class:"mr-2"},null,512),[[se,a.value.is_fixed]]),e[43]||(e[43]=t("label",{for:"is_fixed",class:"text-sm font-medium"},"مصروف ثابت",-1))]),t("div",Ze,[t("button",{type:"button",onClick:P,class:"btn btn-secondary flex-1"},"إلغاء"),t("button",et,o(k.value?"تحديث":"حفظ"),1)])],32)])])):L("",!0),h.value?(x(),m("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[15]||(e[15]=T(s=>h.value=!1,["self"]))},[t("div",tt,[e[48]||(e[48]=t("h3",{class:"text-2xl font-bold mb-4"},"إضافة نوع مصروف",-1)),t("form",{onSubmit:T(H,["prevent"]),class:"space-y-4"},[t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالعربية *",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>f.value.name_ar=s),type:"text",required:"",class:"input",placeholder:"مثال: الإيجار"},null,512),[[b,f.value.name_ar]])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium mb-2"},"الاسم بالإنجليزية",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>f.value.name_en=s),type:"text",class:"input",placeholder:"Example: Rent"},null,512),[[b,f.value.name_en]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium mb-2"},"الوصف",-1)),r(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>f.value.description=s),rows:"2",class:"input",placeholder:"وصف نوع المصروف..."},null,512),[[b,f.value.description]])]),t("div",st,[t("button",{type:"button",onClick:e[14]||(e[14]=s=>h.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),e[47]||(e[47]=t("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):L("",!0)]))}};export{mt as default};
