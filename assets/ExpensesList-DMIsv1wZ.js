import{b as se,r as u,g as le,h as oe,c as x,o as c,d as e,j as I,k as m,y as U,l as g,t as n,e as i,v as f,A as V,F as M,m as R,s as ae,w as T,B as ne,z as b}from"./index-DlHSg48n.js";import{P as O}from"./plus-CLiZr1Yy.js";import{R as ie}from"./receipt-DgJrNbFD.js";import{C as re}from"./calendar-CvUrcD-n.js";import{T as de}from"./trending-up-MXJcFTff.js";import{c as pe}from"./createLucideIcon-oten8gD0.js";import{D as ue}from"./download-DiodNn_y.js";import{X as xe}from"./x-Bed84vi2.js";import{P as ce}from"./pen-C4Y35AtV.js";import{T as me}from"./trash-2-DGK_XvF-.js";/**
 * @license lucide-vue-next v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=pe("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ye={class:"space-y-6"},ve={class:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},fe={class:"flex gap-3"},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},_e={class:"card bg-gradient-to-br from-blue-500 to-blue-600 text-white"},he={class:"flex items-center justify-between"},we={class:"text-3xl font-bold"},ke={class:"text-blue-100 text-xs mt-1"},Ce={class:"card bg-gradient-to-br from-green-500 to-green-600 text-white"},ze={class:"flex items-center justify-between"},Ee={class:"text-3xl font-bold"},De={class:"card bg-gradient-to-br from-purple-500 to-purple-600 text-white"},Se={class:"flex items-center justify-between"},$e={class:"text-3xl font-bold"},Fe={class:"card bg-gradient-to-br from-orange-500 to-orange-600 text-white"},Ue={class:"flex items-center justify-between"},Ve={class:"text-3xl font-bold"},Te={class:"card"},Le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Pe=["value"],je={class:"flex gap-3 mt-4"},Ie={class:"card overflow-hidden"},Me={class:"overflow-x-auto"},Re={class:"w-full"},Ne={class:"divide-y divide-gray-200"},qe={class:"px-6 py-4 whitespace-nowrap text-sm"},Be={class:"px-6 py-4 whitespace-nowrap"},Ge={class:"text-sm font-medium"},Ae={class:"px-6 py-4 whitespace-nowrap"},Oe={class:"text-lg font-bold text-red-600"},He={class:"px-6 py-4 whitespace-nowrap"},We={class:"px-6 py-4 text-sm text-gray-600 max-w-xs truncate"},Xe={class:"px-6 py-4 whitespace-nowrap text-sm"},Je={class:"flex gap-2"},Ke=["onClick"],Qe=["onClick"],Ye={key:0},Ze={class:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},et={class:"text-2xl font-bold mb-4"},tt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},st=["value"],lt={class:"flex items-center"},ot={class:"flex gap-3 pt-2"},at={type:"submit",class:"btn btn-primary flex-1"},nt={class:"bg-white rounded-xl p-6 w-full max-w-md"},it={class:"flex gap-3 pt-2"},bt={__name:"ExpensesList",setup(rt){const r=se(),_=u([]),L=u([]),d=u({total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0}),E=u(!1),C=u(!1),h=u(!1),D=u(null),o=u({start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""}),a=u({expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1}),y=u({name_ar:"",name_en:"",description:""}),H=le(()=>{const s=new Date(o.value.start_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),t=new Date(o.value.end_date).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});return`${s} - ${t}`}),v=async()=>{var s;try{const t={};o.value.start_date&&(t.start_date=o.value.start_date),o.value.end_date&&(t.end_date=o.value.end_date),o.value.expense_type_id&&(t.expense_type_id=o.value.expense_type_id),o.value.recurrence_type&&(t.recurrence_type=o.value.recurrence_type),console.log("Fetching expenses with params:",t);const l=await b.getExpenses(t);console.log("API Response:",l.data),_.value=l.data.data||l.data||[],console.log("Expenses loaded:",_.value.length,_.value)}catch(t){console.error("Failed to fetch expenses:",t),console.error("Error details:",(s=t.response)==null?void 0:s.data),r.error("فشل تحميل المصروفات")}},N=async()=>{try{const s=await b.getExpenseTypes();L.value=s.data.data||[]}catch(s){console.error("Failed to fetch expense types:",s)}},S=async()=>{try{const s={};o.value.start_date&&(s.start_date=o.value.start_date),o.value.end_date&&(s.end_date=o.value.end_date);const t=await b.getExpenseStatistics(s);d.value=t.data.data||{total_expenses:0,monthly_expenses:0,yearly_expenses:0,fixed_expenses:0},console.log("Statistics:",d.value)}catch(s){console.error("Failed to fetch statistics:",s)}},W=()=>{h.value=!1,D.value=null,a.value={expense_type_id:"",amount:"",expense_date:new Date().toISOString().split("T")[0],recurrence_type:"once",remarks:"",is_fixed:!1},E.value=!0},X=s=>{h.value=!0,D.value=s.id,a.value={expense_type_id:s.expense_type_id,amount:s.amount,expense_date:s.expense_date,recurrence_type:s.recurrence_type,remarks:s.remarks||"",is_fixed:s.is_fixed},E.value=!0},J=async()=>{try{h.value?(await b.updateExpense(D.value,a.value),r.success("تم تحديث المصروف بنجاح")):(await b.createExpense(a.value),r.success("تم إضافة المصروف بنجاح")),P(),v(),S()}catch(s){console.error("Failed to save expense:",s),r.error("فشل حفظ المصروف")}},K=async s=>{if(confirm("هل أنت متأكد من حذف هذا المصروف؟"))try{await b.deleteExpense(s),r.success("تم حذف المصروف بنجاح"),v(),S()}catch(t){console.error("Failed to delete expense:",t),r.error("فشل حذف المصروف")}},Q=async()=>{try{await b.createExpenseType(y.value),r.success("تم إضافة نوع المصروف بنجاح"),C.value=!1,y.value={name_ar:"",name_en:"",description:""},N()}catch(s){console.error("Failed to save expense type:",s),r.error("فشل حفظ نوع المصروف")}},P=()=>{E.value=!1,h.value=!1,D.value=null},Y=()=>{o.value={start_date:"2025-01-01",end_date:"2025-12-31",expense_type_id:"",recurrence_type:""},v(),S()},Z=async()=>{try{r.info("جاري إنشاء التقرير...");const s=document.createElement("div");s.style.position="absolute",s.style.left="-9999px",s.style.width="210mm",s.style.padding="20mm",s.style.backgroundColor="white",s.style.fontFamily="Cairo, Arial, sans-serif",s.style.direction="rtl",s.innerHTML=`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="color: #1e40af; font-size: 28px; margin-bottom: 10px;">تقرير المصروفات</h1>
        <p style="color: #666; font-size: 14px;">الفترة: ${o.value.start_date} إلى ${o.value.end_date}</p>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;">
        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 20px; border-radius: 10px;">
          <div style="font-size: 14px; opacity: 0.9;">إجمالي المصروفات</div>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px;">${p(d.value.total_expenses)}</div>
        </div>
        <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 20px; border-radius: 10px;">
          <div style="font-size: 14px; opacity: 0.9;">المصروفات الشهرية</div>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px;">${p(d.value.monthly_expenses)}</div>
        </div>
        <div style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); color: white; padding: 20px; border-radius: 10px;">
          <div style="font-size: 14px; opacity: 0.9;">المصروفات السنوية</div>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px;">${p(d.value.yearly_expenses)}</div>
        </div>
        <div style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); color: white; padding: 20px; border-radius: 10px;">
          <div style="font-size: 14px; opacity: 0.9;">المصروفات الثابتة</div>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px;">${p(d.value.fixed_expenses)}</div>
        </div>
      </div>
      
      <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
          <tr style="background-color: #3b82f6; color: white;">
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">التاريخ</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">نوع المصروف</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">المبلغ</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">التكرار</th>
            <th style="padding: 12px; text-align: right; border: 1px solid #ddd;">ملاحظات</th>
          </tr>
        </thead>
        <tbody>
          ${_.value.map((z,te)=>{var A;return`
            <tr style="background-color: ${te%2===0?"#f9fafb":"white"};">
              <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">${q(z.expense_date)}</td>
              <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">${((A=z.expense_type)==null?void 0:A.name_ar)||"-"}</td>
              <td style="padding: 10px; text-align: right; border: 1px solid #ddd; font-weight: bold; color: #dc2626;">${p(z.amount)}</td>
              <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">${B(z.recurrence_type)}</td>
              <td style="padding: 10px; text-align: right; border: 1px solid #ddd;">${z.remarks||"-"}</td>
            </tr>
          `}).join("")}
        </tbody>
      </table>
      
      <div style="margin-top: 30px; text-align: center; color: #666; font-size: 12px;">
        <p>تم إنشاء التقرير في ${new Date().toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"})}</p>
      </div>
    `,document.body.appendChild(s);const t=await window.html2canvas(s,{scale:2,useCORS:!0,logging:!1,backgroundColor:"#ffffff"});document.body.removeChild(s);const{jsPDF:l}=window.jspdf,w=210,k=t.height*w/t.width,G=t.toDataURL("image/png"),$=new l("p","mm","a4");let F=k,j=0;for($.addImage(G,"PNG",0,j,w,k),F-=297;F>0;)j=F-k,$.addPage(),$.addImage(G,"PNG",0,j,w,k),F-=297;$.save(`expenses-${new Date().toISOString().split("T")[0]}.pdf`),r.success("تم تصدير التقرير بنجاح")}catch(s){console.error("PDF export error:",s),r.error("فشل تصدير التقرير")}},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:2,maximumFractionDigits:2}).format(s||0).replace("EGP","ج.م"),q=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),B=s=>({once:"مرة واحدة",monthly:"شهري",yearly:"سنوي"})[s]||s,ee=s=>({once:"badge badge-secondary",monthly:"badge badge-primary",yearly:"badge badge-success"})[s]||"badge";return oe(()=>{v(),N(),S()}),(s,t)=>(c(),x("div",ye,[e("div",ve,[t[18]||(t[18]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"المصروفات"),e("p",{class:"text-gray-600 mt-1"},"إدارة وتتبع جميع المصروفات")],-1)),e("div",fe,[e("button",{onClick:t[0]||(t[0]=l=>C.value=!0),class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[m(g(O),{size:20}),t[16]||(t[16]=U(" إضافة نوع مصروف ",-1))]),e("button",{onClick:W,class:"px-6 py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[m(g(O),{size:20}),t[17]||(t[17]=U(" إضافة مصروف ",-1))])])]),e("div",be,[e("div",_e,[e("div",he,[e("div",null,[t[19]||(t[19]=e("p",{class:"text-blue-100 text-sm mb-1"},"إجمالي المصروفات",-1)),e("h3",we,n(p(d.value.total_expenses)),1),e("p",ke,n(H.value),1)]),m(g(ie),{size:48,class:"text-blue-200"})])]),e("div",Ce,[e("div",ze,[e("div",null,[t[20]||(t[20]=e("p",{class:"text-green-100 text-sm mb-1"},"المصروفات الشهرية",-1)),e("h3",Ee,n(p(d.value.monthly_expenses)),1),t[21]||(t[21]=e("p",{class:"text-green-100 text-xs mt-1"},"متكررة شهرياً",-1))]),m(g(re),{size:48,class:"text-green-200"})])]),e("div",De,[e("div",Se,[e("div",null,[t[22]||(t[22]=e("p",{class:"text-purple-100 text-sm mb-1"},"المصروفات السنوية",-1)),e("h3",$e,n(p(d.value.yearly_expenses)),1),t[23]||(t[23]=e("p",{class:"text-purple-100 text-xs mt-1"},"متكررة سنوياً",-1))]),m(g(de),{size:48,class:"text-purple-200"})])]),e("div",Fe,[e("div",Ue,[e("div",null,[t[24]||(t[24]=e("p",{class:"text-orange-100 text-sm mb-1"},"المصروفات الثابتة",-1)),e("h3",Ve,n(p(d.value.fixed_expenses)),1),t[25]||(t[25]=e("p",{class:"text-orange-100 text-xs mt-1"},"مصروفات ثابتة",-1))]),m(g(ge),{size:48,class:"text-orange-200"})])])]),e("div",Te,[e("div",Le,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-2"},"من تاريخ",-1)),i(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.start_date=l),type:"date",class:"input",onChange:v},null,544),[[f,o.value.start_date]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-2"},"إلى تاريخ",-1)),i(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.end_date=l),type:"date",class:"input",onChange:v},null,544),[[f,o.value.end_date]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف",-1)),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.expense_type_id=l),class:"input",onChange:v},[t[28]||(t[28]=e("option",{value:""},"الكل",-1)),(c(!0),x(M,null,R(L.value,l=>(c(),x("option",{key:l.id,value:l.id},n(l.name_ar),9,Pe))),128))],544),[[V,o.value.expense_type_id]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium mb-2"},"التكرار",-1)),i(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.recurrence_type=l),class:"input",onChange:v},[...t[30]||(t[30]=[e("option",{value:""},"الكل",-1),e("option",{value:"once"},"مرة واحدة",-1),e("option",{value:"monthly"},"شهري",-1),e("option",{value:"yearly"},"سنوي",-1)])],544),[[V,o.value.recurrence_type]])])]),e("div",je,[e("button",{onClick:Z,class:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[m(g(ue),{size:20}),t[32]||(t[32]=U(" تصدير PDF ",-1))]),e("button",{onClick:Y,class:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2"},[m(g(xe),{size:20}),t[33]||(t[33]=U(" إعادة تعيين ",-1))])])]),e("div",Ie,[e("div",Me,[e("table",Re,[t[35]||(t[35]=e("thead",{class:"bg-gray-50 border-b"},[e("tr",null,[e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التاريخ"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"نوع المصروف"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"المبلغ"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"التكرار"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"ملاحظات"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"إجراءات")])],-1)),e("tbody",Ne,[(c(!0),x(M,null,R(_.value,l=>{var w;return c(),x("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",qe,n(q(l.expense_date)),1),e("td",Be,[e("span",Ge,n(((w=l.expense_type)==null?void 0:w.name_ar)||"غير محدد"),1)]),e("td",Ae,[e("span",Oe,n(p(l.amount)),1)]),e("td",He,[e("span",{class:ae(ee(l.recurrence_type))},n(B(l.recurrence_type)),3)]),e("td",We,n(l.remarks||"-"),1),e("td",Xe,[e("div",Je,[e("button",{onClick:k=>X(l),class:"text-blue-600 hover:text-blue-800"},[m(g(ce),{size:18})],8,Ke),e("button",{onClick:k=>K(l.id),class:"text-red-600 hover:text-red-800"},[m(g(me),{size:18})],8,Qe)])])])}),128)),_.value.length===0?(c(),x("tr",Ye,[...t[34]||(t[34]=[e("td",{colspan:"6",class:"px-6 py-8 text-center text-gray-500"}," لا توجد مصروفات ",-1)])])):I("",!0)])])])]),E.value?(c(),x("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:T(P,["self"])},[e("div",Ze,[e("h3",et,n(h.value?"تعديل مصروف":"إضافة مصروف جديد"),1),e("form",{onSubmit:T(J,["prevent"]),class:"space-y-4"},[e("div",tt,[e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium mb-2"},"نوع المصروف *",-1)),i(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.expense_type_id=l),required:"",class:"input"},[t[36]||(t[36]=e("option",{value:""},"اختر نوع المصروف",-1)),(c(!0),x(M,null,R(L.value,l=>(c(),x("option",{key:l.id,value:l.id},n(l.name_ar),9,st))),128))],512),[[V,a.value.expense_type_id]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium mb-2"},"المبلغ *",-1)),i(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.amount=l),type:"number",step:"0.01",required:"",class:"input",placeholder:"0.00"},null,512),[[f,a.value.amount]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"block text-sm font-medium mb-2"},"التاريخ *",-1)),i(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.expense_date=l),type:"date",required:"",class:"input"},null,512),[[f,a.value.expense_date]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"block text-sm font-medium mb-2"},"التكرار *",-1)),i(e("select",{"onUpdate:modelValue":t[8]||(t[8]=l=>a.value.recurrence_type=l),required:"",class:"input"},[...t[40]||(t[40]=[e("option",{value:"once"},"مرة واحدة",-1),e("option",{value:"monthly"},"شهري",-1),e("option",{value:"yearly"},"سنوي",-1)])],512),[[V,a.value.recurrence_type]])])]),e("div",null,[t[42]||(t[42]=e("label",{class:"block text-sm font-medium mb-2"},"ملاحظات",-1)),i(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=l=>a.value.remarks=l),rows:"3",class:"input",placeholder:"أضف ملاحظات..."},null,512),[[f,a.value.remarks]])]),e("div",lt,[i(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>a.value.is_fixed=l),type:"checkbox",id:"is_fixed",class:"mr-2"},null,512),[[ne,a.value.is_fixed]]),t[43]||(t[43]=e("label",{for:"is_fixed",class:"text-sm font-medium"},"مصروف ثابت",-1))]),e("div",ot,[e("button",{type:"button",onClick:P,class:"btn btn-secondary flex-1"},"إلغاء"),e("button",at,n(h.value?"تحديث":"حفظ"),1)])],32)])])):I("",!0),C.value?(c(),x("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[15]||(t[15]=T(l=>C.value=!1,["self"]))},[e("div",nt,[t[48]||(t[48]=e("h3",{class:"text-2xl font-bold mb-4"},"إضافة نوع مصروف",-1)),e("form",{onSubmit:T(Q,["prevent"]),class:"space-y-4"},[e("div",null,[t[44]||(t[44]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم بالعربية *",-1)),i(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>y.value.name_ar=l),type:"text",required:"",class:"input",placeholder:"مثال: الإيجار"},null,512),[[f,y.value.name_ar]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium mb-2"},"الاسم بالإنجليزية",-1)),i(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>y.value.name_en=l),type:"text",class:"input",placeholder:"Example: Rent"},null,512),[[f,y.value.name_en]])]),e("div",null,[t[46]||(t[46]=e("label",{class:"block text-sm font-medium mb-2"},"الوصف",-1)),i(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=l=>y.value.description=l),rows:"2",class:"input",placeholder:"وصف نوع المصروف..."},null,512),[[f,y.value.description]])]),e("div",it,[e("button",{type:"button",onClick:t[14]||(t[14]=l=>C.value=!1),class:"btn btn-secondary flex-1"},"إلغاء"),t[47]||(t[47]=e("button",{type:"submit",class:"btn btn-primary flex-1"},"حفظ",-1))])],32)])])):I("",!0)]))}};export{bt as default};
